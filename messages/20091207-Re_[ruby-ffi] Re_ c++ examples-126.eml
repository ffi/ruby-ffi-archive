Delivered-To: headius@headius.com
Received: by 10.115.91.6 with SMTP id t6cs704820wal;
        Mon, 7 Dec 2009 11:15:16 -0800 (PST)
Received: by 10.115.81.30 with SMTP id i30mr12637797wal.34.1260213315882;
        Mon, 07 Dec 2009 11:15:15 -0800 (PST)
Return-Path: <3QlQdSwQPCP4k1gtlgrrotmytu2.tkzx0h4-llomuumrkmxu0vy.ius@listserv.bounces.google.com>
Received: from mail-pz0-f148.google.com (mail-pz0-f148.google.com [209.85.222.148])
        by mx.google.com with ESMTP id 14si3735225pxi.27.2009.12.07.11.15.15;
        Mon, 07 Dec 2009 11:15:15 -0800 (PST)
Received-SPF: pass (google.com: domain of 3QlQdSwQPCP4k1gtlgrrotmytu2.tkzx0h4-llomuumrkmxu0vy.ius@listserv.bounces.google.com designates 209.85.222.148 as permitted sender) client-ip=209.85.222.148;
Authentication-Results: mx.google.com; spf=pass (google.com: domain of 3QlQdSwQPCP4k1gtlgrrotmytu2.tkzx0h4-llomuumrkmxu0vy.ius@listserv.bounces.google.com designates 209.85.222.148 as permitted sender) smtp.mail=3QlQdSwQPCP4k1gtlgrrotmytu2.tkzx0h4-llomuumrkmxu0vy.ius@listserv.bounces.google.com
Received: by pzk12 with SMTP id 12sf1319391pzk.13
        for <headius@headius.com>; Mon, 07 Dec 2009 11:15:15 -0800 (PST)
Received: by 10.140.201.13 with SMTP id y13mr452142rvf.24.1260213314746;
        Mon, 07 Dec 2009 11:15:14 -0800 (PST)
X-BeenThere: ruby-ffi@googlegroups.com
Received: by 10.141.105.10 with SMTP id h10ls73337rvm.3.p; Mon, 07 Dec 2009 
	11:15:13 -0800 (PST)
Received: by 10.141.26.3 with SMTP id d3mr1237972rvj.11.1260213313830;
        Mon, 07 Dec 2009 11:15:13 -0800 (PST)
Received: by 10.142.75.18 with SMTP id x18mr1208725wfa.18.1260209652883;
        Mon, 07 Dec 2009 10:14:12 -0800 (PST)
Received: by 10.142.75.18 with SMTP id x18mr1208724wfa.18.1260209652854;
        Mon, 07 Dec 2009 10:14:12 -0800 (PST)
Return-Path: <evan@fallingsnow.net>
Received: from elle.fallingsnow.net (elle.fallingsnow.net [67.43.164.196])
        by gmr-mx.google.com with ESMTP id 24si952125pzk.2.2009.12.07.10.14.11;
        Mon, 07 Dec 2009 10:14:11 -0800 (PST)
Received-SPF: pass (google.com: best guess record for domain of evan@fallingsnow.net designates 67.43.164.196 as permitted sender) client-ip=67.43.164.196;
Received: from cpe-76-170-133-160.socal.res.rr.com ([76.170.133.160] helo=[10.0.1.194])
	by elle.fallingsnow.net with esmtpa (Exim 4.69)
	(envelope-from <evan@fallingsnow.net>)
	id 1NHi61-0008Le-IK
	for ruby-ffi@googlegroups.com; Mon, 07 Dec 2009 10:14:10 -0800
Mime-Version: 1.0 (Apple Message framework v1077)
From: Evan Phoenix <evan@fallingsnow.net>
In-Reply-To: <3d351bca-ca00-47ab-bb05-644547d4a49a@y32g2000prd.googlegroups.com>
Date: Mon, 7 Dec 2009 10:14:04 -0800
Message-Id: <A488E251-8257-44D3-B1C1-245612AB9D2B@fallingsnow.net>
References: <ae3ecdd9-459d-4496-a17a-a9eb1a88d154@v25g2000yqk.googlegroups.com>  <6299bf3a-f922-4bec-beb1-2a723274b099@z7g2000vbl.googlegroups.com>  <9bd8f0b9-5c7e-4370-9167-44db8112167e@u20g2000vbq.googlegroups.com>  <71166b3b0912051418r156d05a0v18ab2503dc2bf1b3@mail.gmail.com> <3d351bca-ca00-47ab-bb05-644547d4a49a@y32g2000prd.googlegroups.com>
To: ruby-ffi@googlegroups.com
X-Mailer: Apple Mail (2.1077)
X-SA-Exim-Connect-IP: 76.170.133.160
X-SA-Exim-Mail-From: evan@fallingsnow.net
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on elle.fallingsnow.net
X-Spam-Level: 
X-Spam-Status: No, score=-4.2 required=5.0 tests=ALL_TRUSTED,AWL,BAYES_00
	autolearn=ham version=3.2.5
Subject: Re: [ruby-ffi] Re: c++ examples
X-SA-Exim-Version: 4.2.1 (built Wed, 25 Jun 2008 17:14:11 +0000)
X-SA-Exim-Scanned: Yes (on elle.fallingsnow.net)
Reply-To: ruby-ffi@googlegroups.com
Precedence: list
Mailing-list: list ruby-ffi@googlegroups.com; contact ruby-ffi+owners@googlegroups.com
List-ID: <ruby-ffi.googlegroups.com>
List-Post: <http://groups.google.com/group/ruby-ffi/post?hl=>, 
	<mailto:ruby-ffi@googlegroups.com>
List-Help: <http://groups.google.com/support/?hl=>, <mailto:ruby-ffi+help@googlegroups.com>
List-Archive: <http://groups.google.com/group/ruby-ffi?hl=>
X-Thread-Url: http://groups.google.com/group/ruby-ffi/t/cb31aba29ae17e59
X-Message-Url: http://groups.google.com/group/ruby-ffi/msg/697d3bfd9098d009
List-Unsubscribe: <http://groups.google.com/group/ruby-ffi/subscribe?hl=>, 
	<mailto:ruby-ffi+unsubscribe@googlegroups.com>
List-Subscribe: <http://groups.google.com/group/ruby-ffi/subscribe?hl=>, 
	<mailto:ruby-ffi+subscribe@googlegroups.com>
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: quoted-printable


On Dec 7, 2009, at 9:55 AM, rogerdpack wrote:

>>> In the end I think I'm going to end up having to write ruby =
containers
>>> for c++ objects, so I'll probably end up having to write a "real"
>>> extension after all.  Anybody know of a cross-VM compatible way to
>>> wrap C objects and call their destructors, etc.?
>>> Thanks.
>>=20
>> You mean C++ objects and make them work with Ruby C API?
>=20
> Good point. C++.
>=20
> It appears on closer inspection that you can call something like
> MyClass.free_object
> (http://wiki.github.com/ffi/ffi/examples)
> on objects, so perhaps I could register my C++ wrapped object using
> ObjectSpace#define_finalizer and call a wrapper to the C++
> destructor.  That might work.

I do not recommend this at all. Using finalizers to release external =
resources is a very easy way to cause memory leaks and latent bugs.

If you need to call a destructor or cleanup function, you should =
explicitly call them when you know you no longer need the data.

Adding the pointer to a cleanup list that can be processed at a common =
place is a simple solution.=20

 - Evan

>=20
> -r
>=20

