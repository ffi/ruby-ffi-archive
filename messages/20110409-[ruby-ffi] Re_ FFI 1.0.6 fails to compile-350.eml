Delivered-To: headius@headius.com
Received: by 10.216.159.147 with SMTP id s19cs27233wek;
        Sat, 9 Apr 2011 04:32:30 -0700 (PDT)
Received: by 10.236.178.8 with SMTP id e8mr4197523yhm.375.1302348750015;
        Sat, 09 Apr 2011 04:32:30 -0700 (PDT)
Return-Path: <ruby-ffi+bncCK695Z6ZDxDHh4HtBBoEEstENg@googlegroups.com>
Received: from mail-gw0-f62.google.com (mail-gw0-f62.google.com [74.125.83.62])
        by mx.google.com with ESMTPS id f9si8918226yhc.226.2011.04.09.04.32.28
        (version=TLSv1/SSLv3 cipher=OTHER);
        Sat, 09 Apr 2011 04:32:29 -0700 (PDT)
Received-SPF: pass (google.com: domain of ruby-ffi+bncCK695Z6ZDxDHh4HtBBoEEstENg@googlegroups.com designates 74.125.83.62 as permitted sender) client-ip=74.125.83.62;
Authentication-Results: mx.google.com; spf=pass (google.com: domain of ruby-ffi+bncCK695Z6ZDxDHh4HtBBoEEstENg@googlegroups.com designates 74.125.83.62 as permitted sender) smtp.mail=ruby-ffi+bncCK695Z6ZDxDHh4HtBBoEEstENg@googlegroups.com; dkim=pass (test mode) header.i=@googlegroups.com
Received: by gwj22 with SMTP id 22sf10605179gwj.7
        for <headius@headius.com>; Sat, 09 Apr 2011 04:32:28 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlegroups.com; s=beta;
        h=domainkey-signature:x-beenthere:mime-version:date:in-reply-to:x-ip
         :references:user-agent:x-http-useragent:message-id:subject:from:to
         :x-original-sender:reply-to:precedence:mailing-list:list-id
         :x-google-group-id:list-post:list-help:list-archive:sender
         :list-subscribe:list-unsubscribe:content-type;
        bh=xI82vKfZzuiva1J1jwHZdXvEfxTB170z1oRigEnb4BE=;
        b=q7WiH7egRmEzTl1dH2gX2bRU422XCgKNWxeGnXo+IfgsSjA0Ump7CccqSEHe1Yet6N
         cP2IHcMtDD22C18J1a87eaSuYY2geXpZ7ngIrHytqMV4HOExEft/zcKhQrJjXZYHQ1tX
         Uv1dAZHZKNebL0YJKhDVFO56Q9Es/Xnz0Aerw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlegroups.com; s=beta;
        h=x-beenthere:mime-version:date:in-reply-to:x-ip:references
         :user-agent:x-http-useragent:message-id:subject:from:to
         :x-original-sender:reply-to:precedence:mailing-list:list-id
         :x-google-group-id:list-post:list-help:list-archive:sender
         :list-subscribe:list-unsubscribe:content-type;
        b=J+5JwZuAX2RquKpjhcf8eDdP239Um4IGCBvTlQky4Jn72CDHKhL3NzLIT3mixX4IQl
         KA7bXppFVRz/RbLoNs/Fnqw8N9ty5KALpVd6Xn0DvLwsify8nQUrEl8p22VWiV2JeD65
         YSW0GK1+nNECGZyiSD+2tP+6/ieYZegdNX+wo=
Received: by 10.90.20.29 with SMTP id 29mr543532agt.57.1302348743295;
        Sat, 09 Apr 2011 04:32:23 -0700 (PDT)
X-BeenThere: ruby-ffi@googlegroups.com
Received: by 10.91.92.14 with SMTP id u14ls38538agl.2.p; Sat, 09 Apr 2011
 04:32:22 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.91.4.27 with SMTP id g27mr541278agi.40.1302348742746; Sat, 09
 Apr 2011 04:32:22 -0700 (PDT)
Received: by e21g2000yqe.googlegroups.com with HTTP; Sat, 9 Apr 2011 04:32:22
 -0700 (PDT)
Date: Sat, 9 Apr 2011 04:32:22 -0700 (PDT)
In-Reply-To: <02905325-fd46-493d-b663-986872f980da@d19g2000yql.googlegroups.com>
X-IP: 77.11.204.142
References: <7f45dbbd-6337-4677-9a6a-8cb4abac5dab@r17g2000vbc.googlegroups.com>
 <20110312095736.309914a5.jon.forums@gmail.com> <02905325-fd46-493d-b663-986872f980da@d19g2000yql.googlegroups.com>
User-Agent: G2/1.0
X-HTTP-UserAgent: Mozilla/5.0 (X11; Linux x86_64; rv:2.0) Gecko/20110321 Firefox/4.0,gzip(gfe)
Message-ID: <30738f47-b6e9-48e6-ae9b-e4c8d989d918@e21g2000yqe.googlegroups.com>
Subject: [ruby-ffi] Re: FFI 1.0.6 fails to compile
From: Quintus <sutniuq@gmx.net>
To: ruby-ffi <ruby-ffi@googlegroups.com>
X-Original-Sender: sutniuq@gmx.net
Reply-To: ruby-ffi@googlegroups.com
Precedence: list
Mailing-list: list ruby-ffi@googlegroups.com; contact ruby-ffi+owners@googlegroups.com
List-ID: <ruby-ffi.googlegroups.com>
X-Google-Group-Id: 238405446264
List-Post: <http://groups.google.com/group/ruby-ffi/post?hl=en_US>, <mailto:ruby-ffi@googlegroups.com>
List-Help: <http://groups.google.com/support/?hl=en_US>, <mailto:ruby-ffi+help@googlegroups.com>
List-Archive: <http://groups.google.com/group/ruby-ffi?hl=en_US>
Sender: ruby-ffi@googlegroups.com
List-Subscribe: <http://groups.google.com/group/ruby-ffi/subscribe?hl=en_US>, <mailto:ruby-ffi+subscribe@googlegroups.com>
List-Unsubscribe: <http://groups.google.com/group/ruby-ffi/subscribe?hl=en_US>,
 <mailto:ruby-ffi+unsubscribe@googlegroups.com>
Content-Type: text/plain; charset=ISO-8859-1

I just found out that Ruby 1.8 gives a more descriptive error
message:
===================================
$ sudo LANG=en_US.utf8 gem18 install ffi
Building native extensions.  This could take a while...
ERROR:  Error installing ffi:
	ERROR: Failed to build gem native extension.

        /opt/rubies/ruby-1.8.7-p334/bin/ruby18 extconf.rb
checking for ffi_call() in -lffi... yes
checking for ffi_prep_closure()... yes
checking for ffi_raw_call()... yes
checking for ffi_prep_raw_closure()... yes
checking for rb_thread_blocking_region()... no
checking for ruby_thread_has_gvl_p()... no
checking for ruby_native_thread_p()... no
checking for rb_thread_call_with_gvl()... no
creating extconf.h
creating Makefile

make
gcc -I. -I. -I/opt/rubies/ruby-1.8.7-p334/lib/ruby/1.8/x86_64-linux -
I. -DRUBY_EXTCONF_H=\"extconf.h\"    -fPIC -g -O2  -fPIC  -I/usr/lib/
libffi-3.0.9/include   -Wno-declaration-after-statement   -c
DataConverter.c
In file included from /usr/include/linux/param.h:4:0,
                 from /usr/include/sys/param.h:28,
                 from ./endian.h:4,
                 from /usr/include/bits/waitstatus.h:65,
                 from /usr/include/stdlib.h:43,
                 from /opt/rubies/ruby-1.8.7-p334/lib/ruby/1.8/x86_64-
linux/ruby.h:40,
                 from DataConverter.c:2:
/usr/include/asm/param.h:1:31: fatal error: asm-generic/param.h: No
such file or directory
compilation terminated.
make: *** [DataConverter.o] Error 1


Gem files will remain installed in /opt/rubies/ruby-1.8.7-p334/lib/
ruby/gems/1.8/gems/ffi-1.0.7 for inspection.
Results logged to /opt/rubies/ruby-1.8.7-p334/lib/ruby/gems/1.8/gems/
ffi-1.0.7/ext/ffi_c/gem_make.out

===================================

The informative part is this one:

/usr/include/asm/param.h:1:31: fatal error: asm-generic/param.h: No
such file or directory

I saw a similar error when I compiled my Ruby, and wondered why
various asm files are missing from my system. Since that day I had to
compile my Ruby with "CFLAGS=-I/usr/src/linux-2.6.37-ARCH/include"
appended to it, which worked but seemed ugly to me. Any clue on what
is broken on my system?

Vale,
Quintus
