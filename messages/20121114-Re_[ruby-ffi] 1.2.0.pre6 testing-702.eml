X-Mozilla-Keys: notjunk $notjunk
Delivered-To: headius@headius.com
Received: by 10.112.81.161 with SMTP id b1csp550212lby;
        Wed, 14 Nov 2012 17:23:38 -0800 (PST)
Received: by 10.68.115.75 with SMTP id jm11mr3163606pbb.28.1352942618030;
        Wed, 14 Nov 2012 17:23:38 -0800 (PST)
Return-Path: <ruby-ffi+bncBC3ZHK4B2AFBBGMISGCQKGQENAJOKXI@googlegroups.com>
Received: from mail-pb0-f55.google.com (mail-pb0-f55.google.com [209.85.160.55])
        by mx.google.com with ESMTPS id uq10si20499504pbc.77.2012.11.14.17.23.37
        (version=TLSv1/SSLv3 cipher=OTHER);
        Wed, 14 Nov 2012 17:23:38 -0800 (PST)
Received-SPF: pass (google.com: domain of ruby-ffi+bncBC3ZHK4B2AFBBGMISGCQKGQENAJOKXI@googlegroups.com designates 209.85.216.177 as permitted sender) client-ip=209.85.216.177;
Authentication-Results: mx.google.com; spf=pass (google.com: domain of ruby-ffi+bncBC3ZHK4B2AFBBGMISGCQKGQENAJOKXI@googlegroups.com designates 209.85.216.177 as permitted sender) smtp.mail=ruby-ffi+bncBC3ZHK4B2AFBBGMISGCQKGQENAJOKXI@googlegroups.com; dkim=pass header.i=@googlegroups.com
Received: by mail-pb0-f55.google.com with SMTP id rp2sf784086pbb.0
        for <headius@headius.com>; Wed, 14 Nov 2012 17:23:37 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlegroups.com; s=20120806;
        h=x-beenthere:received-spf:date:from:to:subject:message-id
         :in-reply-to:references:x-mailer:mime-version:x-original-sender
         :x-original-authentication-results:reply-to:precedence:mailing-list
         :list-id:x-google-group-id:list-post:list-help:list-archive:sender
         :list-subscribe:list-unsubscribe:content-type
         :content-transfer-encoding;
        bh=QT/9UhzvgUs8B01gVmro/Fv7zCbl9lZHAgp6zDq6Fn4=;
        b=Z4w3bXKjpbKuIZu3SJpSs2AMgH0kgyN7F/ARMlZobNW4xI4DC4Y1gI5Y0X+uP3GELk
         9dlHbSqwia4hv6gULMhwyV7Bievxt1vrFiqfaIFYgFJClBdTgSsaph65qk3eTTBzCMMY
         8kT1VARBfhCyzy23aidEKwCIypWITVO+4BUpSfnz6AekP8AlOnXo4laPKLDUN5Yt98bk
         HxO20PJnfyWrcDVkRW9XFUt0hW48lYKFU3S20E313Ru5EXVQTgWBk+uTcwBjxrCgZh2W
         k3o/a3uamMXlvDgX7+GlKpxEJL2gFsnY/Q6WWlpE8y20jImFIb8SBhJAyCsSb1HFA2zJ
         /4bw==
Received: by 10.49.108.131 with SMTP id hk3mr50020qeb.15.1352942617199;
        Wed, 14 Nov 2012 17:23:37 -0800 (PST)
X-BeenThere: ruby-ffi@googlegroups.com
Received: by 10.49.6.72 with SMTP id y8ls73320qey.66.gmail; Wed, 14 Nov 2012
 17:23:36 -0800 (PST)
Received: by 10.224.207.66 with SMTP id fx2mr11083221qab.7.1352942616914;
        Wed, 14 Nov 2012 17:23:36 -0800 (PST)
Received: by 10.224.207.66 with SMTP id fx2mr11083220qab.7.1352942616893;
        Wed, 14 Nov 2012 17:23:36 -0800 (PST)
Received: from mail-qc0-f177.google.com (mail-qc0-f177.google.com [209.85.216.177])
        by gmr-mx.google.com with ESMTPS id y1si1638684qco.0.2012.11.14.17.23.36
        (version=TLSv1/SSLv3 cipher=OTHER);
        Wed, 14 Nov 2012 17:23:36 -0800 (PST)
Received-SPF: pass (google.com: domain of jon.forums@gmail.com designates 209.85.216.177 as permitted sender) client-ip=209.85.216.177;
Received: by mail-qc0-f177.google.com with SMTP id u28so829036qcs.8
        for <ruby-ffi@googlegroups.com>; Wed, 14 Nov 2012 17:23:36 -0800 (PST)
Received: by 10.229.114.217 with SMTP id f25mr6576999qcq.46.1352942616732;
        Wed, 14 Nov 2012 17:23:36 -0800 (PST)
Received: from Red (cpe-65-185-110-237.woh.res.rr.com. [65.185.110.237])
        by mx.google.com with ESMTPS id ga9sm3672391qab.22.2012.11.14.17.23.35
        (version=TLSv1/SSLv3 cipher=OTHER);
        Wed, 14 Nov 2012 17:23:36 -0800 (PST)
Date: Wed, 14 Nov 2012 20:23:39 -0500
From: Jon <jon.forums@gmail.com>
To: ruby-ffi@googlegroups.com
Subject: Re: [ruby-ffi] 1.2.0.pre6 testing
Message-Id: <20121114202339.8d30e9352008bcab89e8506c@gmail.com>
In-Reply-To: <20121114200722.3476b8bdc2e3a635d43d365e@gmail.com>
References: <ded4dedd-a8fc-42da-a5d1-7ce046e56d00@googlegroups.com>
	<20121113231711.59b543ca9e6a6510786ca3de@gmail.com>
	<39b46a99-c1b4-477e-92ea-fc1a1417552a@googlegroups.com>
	<20121114173715.26b0f2fc4ebc3c3087adf18e@gmail.com>
	<20121114200722.3476b8bdc2e3a635d43d365e@gmail.com>
X-Mailer: Sylpheed 3.3.0 (GTK+ 2.10.14; i686-pc-mingw32)
Mime-Version: 1.0
X-Original-Sender: jon.forums@gmail.com
X-Original-Authentication-Results: gmr-mx.google.com; spf=pass (google.com:
 domain of jon.forums@gmail.com designates 209.85.216.177 as permitted sender)
 smtp.mail=jon.forums@gmail.com; dkim=pass header.i=@gmail.com
Reply-To: ruby-ffi@googlegroups.com
Precedence: list
Mailing-list: list ruby-ffi@googlegroups.com; contact ruby-ffi+owners@googlegroups.com
List-ID: <ruby-ffi.googlegroups.com>
X-Google-Group-Id: 238405446264
List-Post: <http://groups.google.com/group/ruby-ffi/post?hl=en_US>, <mailto:ruby-ffi@googlegroups.com>
List-Help: <http://groups.google.com/support/?hl=en_US>, <mailto:ruby-ffi+help@googlegroups.com>
List-Archive: <http://groups.google.com/group/ruby-ffi?hl=en_US>
Sender: ruby-ffi@googlegroups.com
List-Subscribe: <http://groups.google.com/group/ruby-ffi/subscribe?hl=en_US>, <mailto:ruby-ffi+subscribe@googlegroups.com>
List-Unsubscribe: <http://groups.google.com/group/ruby-ffi/subscribe?hl=en_US>,
 <mailto:googlegroups-manage+238405446264+unsubscribe@googlegroups.com>
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

On Wed, 14 Nov 2012 20:07:22 -0500
Jon <jon.forums@gmail.com> wrote:

> > > > While I never install ffi this way, jruby+bundler on Win7 32bit with JRuby 
> > > > 1.7.0 ended up in Wile E. flames trying to build the C ext due to my 
> > > > scheming: 
> > > >
> > > > C:\Users\Jon\Downloads\temp\ffi-java>type Gemfile 
> > > > source :rubygems 
> > > > gem 'ffi', '1.2.0.pre6', :platforms => :jruby 
> > > >
> > > > C:\Users\Jon\Downloads\temp\ffi-java>bundle install 
> > > > Fetching gem metadata from http://rubygems.org/........... 
> > > > Fetching gem metadata from http://rubygems.org/.. 
> > > > Installing ffi (1.2.0.pre6) with native extensions 
> > > > Gem::Installer::ExtensionBuildError: ERROR: Failed to build gem native 
> > > > extension. 
> > > 
> > >  
> > > Hmm.  When installing on something that is not MRI, extconf.rb generates a 
> > > dummy Makefile.  I suspect on win32, the dummy Makefile isn't quite 
> > > correct.  Can you investigate this one a bit more (look right at the bottom 
> > > of ext/ext_c/extconf.rb)?  It could be something as simple as \r\n vs \n 
> > > line termination.
> > > 
> > > I can continue to publish the ffi-java gem, but, I want to get rid of it in 
> > > the long term.
> > 
> > Likely just need this tweak at extconf.rb:59
> > 
> > -  File.open("Makefile", "w") do |mf|
> > +  File.open("Makefile", "wb") do |mf|
> > 
> > I'll try it out a bit later.
> 
> While binary mode may turn out to be an issue, the bigger issue is the dummy Makefile. If a JRuby on Windows user doesn't have `make` on PATH...eeek.
> 
> Perhaps an alternative is to change from a extconf.rb to a Rakefile based extension:
> 
>   https://github.com/rubygems/rubygems/blob/master/lib/rubygems/installer.rb#L667-680
>   https://github.com/rubygems/rubygems/blob/master/lib/rubygems/ext/rake_builder.rb#L22-36
> 
> I don't build native gems this way, but it looks like we could use the Rakefile to wrap 
> 
>   https://github.com/rubygems/rubygems/blob/master/lib/rubygems/ext/ext_conf_builder.rb#L12-21
> 
> since both `build` class methods take the same args, and both return a `results` Array.
> 
> A bit more complicated, but is there any scenario (regardless of platform) where a successful FFI gem install truly requires a JRuby user to have build tools on PATH?

Oh hell, scratch that...doing too many things at once.

I'm not seeing how the Rakefile can call `Gem::Ext::ExtConfBuilder.build` with the same args as sent to the original `Gem::Ext::RakeBuilder.build`.
