Delivered-To: headius@headius.com
Received: by 10.224.80.134 with SMTP id t6cs475419qak;
        Tue, 9 Mar 2010 18:46:32 -0800 (PST)
Received: by 10.140.56.7 with SMTP id e7mr473322rva.227.1268189191127;
        Tue, 09 Mar 2010 18:46:31 -0800 (PST)
Return-Path: <3BAiXSwkJCO4mcUYiidUhWcQYb.SechkRo-VVYWeeWbUWhekfi.Sec@groups.bounces.google.com>
Received: from mail-pz0-f157.google.com (mail-pz0-f157.google.com [209.85.222.157])
        by mx.google.com with ESMTP id 5si9994506pzk.14.2010.03.09.18.46.29;
        Tue, 09 Mar 2010 18:46:30 -0800 (PST)
Received-SPF: pass (google.com: domain of 3BAiXSwkJCO4mcUYiidUhWcQYb.SechkRo-VVYWeeWbUWhekfi.Sec@groups.bounces.google.com designates 209.85.222.157 as permitted sender) client-ip=209.85.222.157;
Authentication-Results: mx.google.com; spf=pass (google.com: domain of 3BAiXSwkJCO4mcUYiidUhWcQYb.SechkRo-VVYWeeWbUWhekfi.Sec@groups.bounces.google.com designates 209.85.222.157 as permitted sender) smtp.mail=3BAiXSwkJCO4mcUYiidUhWcQYb.SechkRo-VVYWeeWbUWhekfi.Sec@groups.bounces.google.com; dkim=pass (test mode) header.i=@googlegroups.com
Received: by pzk29 with SMTP id 29sf2268270pzk.23
        for <headius@headius.com>; Tue, 09 Mar 2010 18:46:29 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlegroups.com; s=beta;
        h=domainkey-signature:received:x-beenthere:received:received:received
         :received:received-spf:received:mime-version:received:in-reply-to
         :references:date:message-id:subject:from:to
         :x-original-authentication-results:x-original-sender:reply-to
         :precedence:mailing-list:list-id:list-post:list-help:list-archive
         :x-thread-url:x-message-url:sender:list-subscribe:list-unsubscribe
         :content-type:content-transfer-encoding;
        bh=ZRC/Iz7Ho+JlIU4h+RxHHwfgF6uy50YClfy2lvGRZks=;
        b=V91R06XfGNCCBHaCKEjT6rqNP9JW09sYyJMCd0HyX3qOtOAjOVKYmsdjklWM6Ukeix
         ZYXQratkVK/Vf+RMobY60g3QEKgPAaX/JLIRVd1OwZtZH1uPIfN4kQ5SV8/V/URezOI4
         nNOQ01IzlwegjvibX0GSsV3GblchX6qTN5GXA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlegroups.com; s=beta;
        h=x-beenthere:received-spf:mime-version:in-reply-to:references:date
         :message-id:subject:from:to:x-original-authentication-results
         :x-original-sender:reply-to:precedence:mailing-list:list-id
         :list-post:list-help:list-archive:x-thread-url:x-message-url:sender
         :list-subscribe:list-unsubscribe:content-type
         :content-transfer-encoding;
        b=VDqx/0s4Q6jSimElYrTmKBh3R9hMjpwsmUxYKkvtlzjRdpL7znPS5xALwRoJ47H/fN
         aHflw3m0KDQ9qhTEpVUsQLtUtZtdgyqvPPzhR+AsCb0HO7EtxYcSCwfBcsDMttsorJ2t
         UePCx3vJ8AxgLsYjq8HmHh0TUkoGkcSR3krjM=
Received: by 10.141.4.8 with SMTP id g8mr64135rvi.14.1268189188461;
        Tue, 09 Mar 2010 18:46:28 -0800 (PST)
X-BeenThere: ruby-ffi@googlegroups.com
Received: by 10.141.188.27 with SMTP id q27ls1474272rvp.3.p; Tue, 09 Mar 2010 
	18:46:27 -0800 (PST)
Received: by 10.140.83.31 with SMTP id g31mr157608rvb.10.1268189187512;
        Tue, 09 Mar 2010 18:46:27 -0800 (PST)
Received: by 10.140.83.31 with SMTP id g31mr157607rvb.10.1268189187493;
        Tue, 09 Mar 2010 18:46:27 -0800 (PST)
Return-Path: <wmeissner@gmail.com>
Received: from mail-pz0-f188.google.com (mail-pz0-f188.google.com [209.85.222.188])
        by gmr-mx.google.com with ESMTP id 19si1830558pzk.7.2010.03.09.18.46.26;
        Tue, 09 Mar 2010 18:46:26 -0800 (PST)
Received-SPF: pass (google.com: domain of wmeissner@gmail.com designates 209.85.222.188 as permitted sender) client-ip=209.85.222.188;
Received: by mail-pz0-f188.google.com with SMTP id 26so713448pzk.18
        for <ruby-ffi@googlegroups.com>; Tue, 09 Mar 2010 18:46:26 -0800 (PST)
MIME-Version: 1.0
Received: by 10.141.5.7 with SMTP id h7mr459899rvi.279.1268189186262; Tue, 09 
	Mar 2010 18:46:26 -0800 (PST)
In-Reply-To: <7eee96c4-b2a0-458c-92e8-665972cc3d43@a10g2000pri.googlegroups.com>
References: <59718a03-d170-44e8-9d45-44c00ce112a2@m35g2000prh.googlegroups.com>
	 <7eee96c4-b2a0-458c-92e8-665972cc3d43@a10g2000pri.googlegroups.com>
Date: Wed, 10 Mar 2010 12:46:26 +1000
Message-ID: <4ccee321003091846l3c7309d1r6f18c2cabe4a90b3@mail.gmail.com>
Subject: Re: [ruby-ffi] Re: newbie question ffi on OsX
From: Wayne Meissner <wmeissner@gmail.com>
To: ruby-ffi@googlegroups.com
X-Original-Authentication-Results: gmr-mx.google.com; spf=pass (google.com: 
	domain of wmeissner@gmail.com designates 209.85.222.188 as permitted sender) 
	smtp.mail=wmeissner@gmail.com; dkim=pass (test mode) header.i=@gmail.com
X-Original-Sender: wmeissner@gmail.com
Reply-To: ruby-ffi@googlegroups.com
Precedence: list
Mailing-list: list ruby-ffi@googlegroups.com; contact ruby-ffi+owners@googlegroups.com
List-ID: <ruby-ffi.googlegroups.com>
List-Post: <http://groups.google.com/group/ruby-ffi/post?hl=en_US>, 
	<mailto:ruby-ffi@googlegroups.com>
List-Help: <http://groups.google.com/support/?hl=en_US>, <mailto:ruby-ffi+help@googlegroups.com>
List-Archive: <http://groups.google.com/group/ruby-ffi?hl=en_US>
X-Thread-Url: http://groups.google.com/group/ruby-ffi/t/f48bd31c2e7cbe
X-Message-Url: http://groups.google.com/group/ruby-ffi/msg/5140b342b86336f7
Sender: ruby-ffi@googlegroups.com
List-Subscribe: <http://groups.google.com/group/ruby-ffi/subscribe?hl=en_US>, 
	<mailto:ruby-ffi+subscribe@googlegroups.com>
List-Unsubscribe: <http://groups.google.com/group/ruby-ffi/subscribe?hl=en_US>, 
	<mailto:ruby-ffi+unsubscribe@googlegroups.com>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

You are now the honorary universal binary expert for ruby-ffi on
MacOS.  Turn your email thread into a FAQ and put it up on the wiki.


On 10 March 2010 00:56, macarthy <justin.maccarthy@gmail.com> wrote:
> Answering my own question, since I can't recompile the lib as 64bit I
> was able to run ruby as 32 bit and ffi works fine, Commands and output
> below.
>
> $ lipo -info /usr/local/lib/libmylib.dylib
> Non-fat file: /usr/local/lib/libmylib.dylib is architecture: i386
>
> $ lipo -detailed_info /usr/bin/ruby
> Fat header in: /usr/bin/ruby
> fat_magic 0xcafebabe
> nfat_arch 3
> architecture x86_64
> =A0 =A0cputype CPU_TYPE_X86_64
> =A0 =A0cpusubtype CPU_SUBTYPE_X86_64_ALL
> =A0 =A0offset 4096
> =A0 =A0size 14176
> =A0 =A0align 2^12 (4096)
> architecture i386
> =A0 =A0cputype CPU_TYPE_I386
> =A0 =A0cpusubtype CPU_SUBTYPE_I386_ALL
> =A0 =A0offset 20480
> =A0 =A0size 14112
> =A0 =A0align 2^12 (4096)
> architecture ppc7400
> =A0 =A0cputype CPU_TYPE_POWERPC
> =A0 =A0cpusubtype CPU_SUBTYPE_POWERPC_7400
> =A0 =A0offset 36864
> =A0 =A0size 13904
> =A0 =A0align 2^12 (4096)
>
>
> $ arch -arch i386 /usr/bin/ruby libmylib.rb
>
>
>> Hi all,
>>
>> Can someone explain this error ? Obviously an architecture mismatch of
>> some sort, how does one got about fixing this? Or compile libmylib as
>> a different arch (or as several ? )
>>
>> /Library/Ruby/Gems/1.8/gems/ffi-0.6.2/lib/ffi/library.rb:61:in
>> `ffi_lib': Could not open library 'libmylib.dylib':
>> dlopen(libmylib.dylib, 9): no suitable image found. =A0Did find:
>> (LoadError)
>>
>> /usr/local/lib/libmylib.dylib: mach-o, but wrong architecture. Could
>> not open library 'libmylib': dlopen(libmylib, 9): image not found
>> =A0 =A0 =A0 =A0 from /Library/Ruby/Gems/1.8/gems/ffi-0.6.2/lib/ffi/libra=
ry.rb:
>> 43:in `map'
>> =A0 =A0 =A0 =A0 from /Library/Ruby/Gems/1.8/gems/ffi-0.6.2/lib/ffi/libra=
ry.rb:
>> 43:in `ffi_lib'
>> =A0 =A0 =A0 =A0 from xxx.rb:14
>>
>> otool gives me this ...
>>
>> =A0otool -h /usr/local/lib/libmylib.dylib
>>
>> /usr/local/lib/libmylib.dylib:
>> Mach header
>> =A0 =A0 =A0 magic cputype cpusubtype =A0caps =A0 =A0filetype ncmds sizeo=
fcmds
>> flags
>> =A00xfeedface =A0 =A0 =A0 7 =A0 =A0 =A0 =A0 =A03 =A00x00 =A0 =A0 =A0 =A0=
 =A06 =A0 =A020 =A0 =A0 =A0 2404
>> 0x00118085
>>
>> Thanks
>
