<html>
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>[ruby-ffi] Unable to load .so file - any ideas?</title>
<link rel="important stylesheet" href="">
<style>div.headerdisplayname {font-weight:bold;}</style></head>
<body>
<table border=0 cellspacing=0 cellpadding=0 width="100%" class="header-part1"><tr><td><div class="headerdisplayname" style="display:inline;">Subject: </div>[ruby-ffi] Unable to load .so file - any ideas?</td></tr><tr><td><div class="headerdisplayname" style="display:inline;">From: </div>Tony Summerville <tsummerville@rarestep.com></td></tr><tr><td><div class="headerdisplayname" style="display:inline;">Date: </div>3/6/12 9:10 AM</td></tr></table><table border=0 cellspacing=0 cellpadding=0 width="100%" class="header-part2"><tr><td><div class="headerdisplayname" style="display:inline;">To: </div>ruby-ffi@googlegroups.com</td></tr></table><br>
<div class="moz-text-html"  lang="x-unicode">I'd really appreciate any help or thoughts on this issue.<div><br></div><div>I'm trying to wrap a simple shared library in a Ruby Gem. The <font face="'courier new', monospace">.so</font> file was precompiled by a 3rd-party vendor and I don't have access to the C source files.</div><div><br></div><div>I've installed FFI gem v1.0.11 and am able to get the basic "<font face="'courier new', monospace">getpid</font>" example working perfectly, but when I try to load the <font face="'courier new', monospace">.so</font> file I get the following error:</div><div><br></div><div><font face="'courier new', monospace">ruby-1.9.2-p180 :001 &gt; require "prova-vhm-raw2xml"<br></font></div><div><div><font face="'courier new', monospace">LoadError: Could not open library '/Users/tsummerville/.rvm/gems/ruby-1.9.2-p180@prova-vhm-raw2xml/gems/prova-vhm-raw2xml-0.1.0/lib/libZVLParser64/libZVLParser64.so': dlopen(/Users/tsummerville/.rvm/gems/ruby-1.9.2-p180@prova-vhm-raw2xml/gems/prova-vhm-raw2xml-0.1.0/lib/libZVLParser64/libZVLParser64.so, 5): no suitable image found. &nbsp;Did find:</font></div><div><font face="'courier new', monospace"><span class="Apple-tab-span" style="white-space:pre">	</span>/Users/tsummerville/.rvm/gems/ruby-1.9.2-p180@prova-vhm-raw2xml/gems/prova-vhm-raw2xml-0.1.0/lib/libZVLParser64/libZVLParser64.so: unknown file type, first eight bytes: 0x7F 0x45 0x4C 0x46 0x02 0x01 0x01 0x00</font></div><div><font face="'courier new', monospace"><span class="Apple-tab-span" style="white-space:pre">	</span>from /Users/tsummerville/.rvm/gems/ruby-1.9.2-p180@prova-vhm-raw2xml/gems/ffi-1.0.11/lib/ffi/library.rb:121:in `block in ffi_lib'</font></div><div><font face="'courier new', monospace"><span class="Apple-tab-span" style="white-space:pre">	</span>from /Users/tsummerville/.rvm/gems/ruby-1.9.2-p180@prova-vhm-raw2xml/gems/ffi-1.0.11/lib/ffi/library.rb:88:in `map'</font></div><div><font face="'courier new', monospace"><span class="Apple-tab-span" style="white-space:pre">	</span>from /Users/tsummerville/.rvm/gems/ruby-1.9.2-p180@prova-vhm-raw2xml/gems/ffi-1.0.11/lib/ffi/library.rb:88:in `ffi_lib'</font></div><div><font face="'courier new', monospace"><span class="Apple-tab-span" style="white-space:pre">	</span>from /Users/tsummerville/.rvm/gems/ruby-1.9.2-p180@prova-vhm-raw2xml/gems/prova-vhm-raw2xml-0.1.0/lib/prova-vhm-raw2xml.rb:9:in `&lt;module:Raw2Xml&gt;'</font></div><div><font face="'courier new', monospace"><span class="Apple-tab-span" style="white-space:pre">	</span>from /Users/tsummerville/.rvm/gems/ruby-1.9.2-p180@prova-vhm-raw2xml/gems/prova-vhm-raw2xml-0.1.0/lib/prova-vhm-raw2xml.rb:6:in `&lt;module:ProvaVHM&gt;'</font></div><div><font face="'courier new', monospace"><span class="Apple-tab-span" style="white-space:pre">	</span>from /Users/tsummerville/.rvm/gems/ruby-1.9.2-p180@prova-vhm-raw2xml/gems/prova-vhm-raw2xml-0.1.0/lib/prova-vhm-raw2xml.rb:5:in `&lt;module:Fleetio&gt;'</font></div><div><font face="'courier new', monospace"><span class="Apple-tab-span" style="white-space:pre">	</span>from /Users/tsummerville/.rvm/gems/ruby-1.9.2-p180@prova-vhm-raw2xml/gems/prova-vhm-raw2xml-0.1.0/lib/prova-vhm-raw2xml.rb:4:in `&lt;top (required)&gt;'</font></div><div><font face="'courier new', monospace"><span class="Apple-tab-span" style="white-space:pre">	</span>from /Users/tsummerville/.rvm/rubies/ruby-1.9.2-p180/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:60:in `require'</font></div><div><font face="'courier new', monospace"><span class="Apple-tab-span" style="white-space:pre">	</span>from /Users/tsummerville/.rvm/rubies/ruby-1.9.2-p180/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:60:in `rescue in require'</font></div><div><font face="'courier new', monospace"><span class="Apple-tab-span" style="white-space:pre">	</span>from /Users/tsummerville/.rvm/rubies/ruby-1.9.2-p180/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:35:in `require'</font></div><div><font face="'courier new', monospace"><span class="Apple-tab-span" style="white-space:pre">	</span>from (irb):1</font></div><div><font face="'courier new', monospace"><span class="Apple-tab-span" style="white-space:pre">	</span>from /Users/tsummerville/.rvm/rubies/ruby-1.9.2-p180/bin/irb:16:in `&lt;main&gt;'</font></div></div><div><br></div><div>Here's the relevant directories/files in my Ruby Gem:</div><div><br></div><div><font face="'courier new', monospace">/prova-vhm-raw2xml</font></div><div><font face="'courier new', monospace">&nbsp; /lib</font></div><div><font face="'courier new', monospace">&nbsp; &nbsp; /prova-vhm-raw2xml.rb</font></div><div><font face="'courier new', monospace">&nbsp; &nbsp; /libZVLParser64</font></div><div><font face="'courier new', monospace">&nbsp; &nbsp; &nbsp; /libZVLParser64.so</font></div><div><br></div><div>Here's the relevant code in&nbsp;<font face="'courier new', monospace">prova-vhm-raw2xml.rb</font>:</div><div><br></div><div><font face="'courier new', monospace">require 'ffi'<br></font></div><div><font face="'courier new', monospace"><br></font></div><div><div><font face="'courier new', monospace">module ProvaVHM</font></div><div><font face="'courier new', monospace">&nbsp; module Raw2Xml</font></div><div><font face="'courier new', monospace">&nbsp; &nbsp; extend FFI::Library</font></div><div><font face="'courier new', monospace">&nbsp;&nbsp;</font></div><div><font face="'courier new', monospace">&nbsp; &nbsp; ffi_lib File.expand_path(File.dirname(__FILE__) + '/libZVLParser64/libZVLParser64.so')</font></div><div><font face="'courier new', monospace">&nbsp;&nbsp;</font></div><div><font face="'courier new', monospace">&nbsp; &nbsp; # THIS WORKS FINE.</font></div><div><font face="'courier new', monospace">&nbsp; &nbsp; # ffi_lib FFI::Library::LIBC</font></div><div><font face="'courier new', monospace">&nbsp; &nbsp; # attach_function :getpid, [], :int</font></div><div><font face="'courier new', monospace">&nbsp;&nbsp;</font></div><div><font face="'courier new', monospace">&nbsp; &nbsp; def self.hi</font></div><div><font face="'courier new', monospace">&nbsp; &nbsp; &nbsp; puts "Hola!"</font></div><div><font face="'courier new', monospace">&nbsp; &nbsp; end</font></div><div><font face="'courier new', monospace">&nbsp; end</font></div><div><font face="'courier new', monospace">end</font></div></div><div><font face="'courier new', monospace"><br></font></div><div><font face="arial, sans-serif">Other potentially relevant notes:</font></div><div><font face="arial, sans-serif">- I'm on Mac OSX with 64 bit processor</font></div><div><font face="arial, sans-serif">- The&nbsp;</font><span style="font-family: 'courier new', monospace; ">libZVLParser64.so </span><font face="arial, sans-serif">was compiled for 64 bit architecture</font></div><div><font face="arial, sans-serif"><br></font></div><div><font face="arial, sans-serif">Anything obvious that I'm missing? I'm new to FFI and wrapping C libs with Ruby in general, so I'm just not quite sure what I'm doing wrong. I've read through all the documentation and looked through the Google Group but can't figure out what the problem is.</font></div><div><font face="arial, sans-serif"><br></font></div><div><font face="arial, sans-serif">Thanks again for any help or insight you can provide!</font></div>
</div></body>
</html>
</table></div>