Delivered-To: headius@headius.com
Received: by 10.204.51.207 with SMTP id e15cs69917bkg;
        Thu, 2 Sep 2010 11:28:33 -0700 (PDT)
Received: by 10.223.126.14 with SMTP id a14mr214445fas.44.1283452113612;
        Thu, 02 Sep 2010 11:28:33 -0700 (PDT)
Return-Path: <ruby-ffi+bncCOzPnYuqHRDQ2f_jBBoE2WL5Gg@googlegroups.com>
Received: from mail-fx0-f62.google.com (mail-fx0-f62.google.com [209.85.161.62])
        by mx.google.com with ESMTP id w34si800889fao.41.2010.09.02.11.28.32;
        Thu, 02 Sep 2010 11:28:32 -0700 (PDT)
Received-SPF: pass (google.com: domain of ruby-ffi+bncCOzPnYuqHRDQ2f_jBBoE2WL5Gg@googlegroups.com designates 209.85.161.62 as permitted sender) client-ip=209.85.161.62;
Authentication-Results: mx.google.com; spf=pass (google.com: domain of ruby-ffi+bncCOzPnYuqHRDQ2f_jBBoE2WL5Gg@googlegroups.com designates 209.85.161.62 as permitted sender) smtp.mail=ruby-ffi+bncCOzPnYuqHRDQ2f_jBBoE2WL5Gg@googlegroups.com; dkim=pass (test mode) header.i=@googlegroups.com
Received: by fxm13 with SMTP id 13sf127234fxm.7
        for <headius@headius.com>; Thu, 02 Sep 2010 11:28:32 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlegroups.com; s=beta;
        h=domainkey-signature:received:x-beenthere:received:received:received
         :received:received-spf:received:received:mime-version:received
         :in-reply-to:references:from:date:message-id:subject:to
         :x-original-sender:x-original-authentication-results:reply-to
         :precedence:mailing-list:list-id:list-post:list-help:list-archive
         :sender:list-subscribe:list-unsubscribe:content-type
         :content-transfer-encoding;
        bh=r5OUlyMXQTkH7PWL7NcdXMRTBftLJ8+KLlO90gf7kFY=;
        b=t+QXq4MfTOWekH77xaB8+KMBe5XgNyRaufhJGOgiLdpefdzYu1XuuR79uOzYc7nzBZ
         /xRKGJ8QnAVLnjsnE50073o1ahHtuVWR3BDTdlkboUSgHpHHcnZ0Z299oOxU8JErsaVE
         kHbN9hYxkwAYT7vIaky34boQ2OZH02Y4BqeMI=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlegroups.com; s=beta;
        h=x-beenthere:received-spf:mime-version:in-reply-to:references:from
         :date:message-id:subject:to:x-original-sender
         :x-original-authentication-results:reply-to:precedence:mailing-list
         :list-id:list-post:list-help:list-archive:sender:list-subscribe
         :list-unsubscribe:content-type:content-transfer-encoding;
        b=Kl3mVD1ZS+7j1TNkDlCAS1veHAZ8WkWlbZJG8Nn5dxytQqqpQsFUEnjpAYnS15aZW+
         vu0NP3pYrAQ6sVkLPwbfhNTCWjR/XZgejGkfYq1/6Jdfa7q2PKU679ZIWR0oJromHCDl
         FQQWRb4oAtsnuL1P/BZo/LZt6GmB0UMWYZdIo=
Received: by 10.223.85.137 with SMTP id o9mr334733fal.24.1283452112126;
        Thu, 02 Sep 2010 11:28:32 -0700 (PDT)
X-BeenThere: ruby-ffi@googlegroups.com
Received: by 10.223.59.212 with SMTP id m20ls229825fah.3.p; Thu, 02 Sep 2010
 11:28:30 -0700 (PDT)
Received: by 10.223.123.202 with SMTP id q10mr553156far.14.1283452110964;
        Thu, 02 Sep 2010 11:28:30 -0700 (PDT)
Received: by 10.223.123.202 with SMTP id q10mr553155far.14.1283452110910;
        Thu, 02 Sep 2010 11:28:30 -0700 (PDT)
Received: from mail-bw0-f49.google.com (mail-bw0-f49.google.com [209.85.214.49])
        by gmr-mx.google.com with ESMTP id l23si189665fam.14.2010.09.02.11.28.29;
        Thu, 02 Sep 2010 11:28:29 -0700 (PDT)
Received-SPF: pass (google.com: domain of luislavena@gmail.com designates 209.85.214.49 as permitted sender) client-ip=209.85.214.49;
Received: by bwz13 with SMTP id 13so1112546bwz.36
        for <ruby-ffi@googlegroups.com>; Thu, 02 Sep 2010 11:28:29 -0700 (PDT)
Received: by 10.204.146.153 with SMTP id h25mr7030797bkv.86.1283452108443;
 Thu, 02 Sep 2010 11:28:28 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.204.72.10 with HTTP; Thu, 2 Sep 2010 11:28:08 -0700 (PDT)
In-Reply-To: <857a7e34-f026-467d-87d0-3a18b81a1b35@i13g2000yqd.googlegroups.com>
References: <857a7e34-f026-467d-87d0-3a18b81a1b35@i13g2000yqd.googlegroups.com>
From: Luis Lavena <luislavena@gmail.com>
Date: Thu, 2 Sep 2010 15:28:08 -0300
Message-ID: <AANLkTimkDH=fX3sCtjY+3H+phDJ-jSG1pYZj3wybjq+n@mail.gmail.com>
Subject: Re: [ruby-ffi] Help for Beginner - Compiling C Extension on Windows
To: ruby-ffi@googlegroups.com
X-Original-Sender: luislavena@gmail.com
X-Original-Authentication-Results: gmr-mx.google.com; spf=pass (google.com:
 domain of luislavena@gmail.com designates 209.85.214.49 as permitted sender)
 smtp.mail=luislavena@gmail.com; dkim=pass (test mode) header.i=@gmail.com
Reply-To: ruby-ffi@googlegroups.com
Precedence: list
Mailing-list: list ruby-ffi@googlegroups.com; contact ruby-ffi+owners@googlegroups.com
List-ID: <ruby-ffi.googlegroups.com>
List-Post: <http://groups.google.com/group/ruby-ffi/post?hl=en_US>, <mailto:ruby-ffi@googlegroups.com>
List-Help: <http://groups.google.com/support/?hl=en_US>, <mailto:ruby-ffi+help@googlegroups.com>
List-Archive: <http://groups.google.com/group/ruby-ffi?hl=en_US>
Sender: ruby-ffi@googlegroups.com
List-Subscribe: <http://groups.google.com/group/ruby-ffi/subscribe?hl=en_US>, <mailto:ruby-ffi+subscribe@googlegroups.com>
List-Unsubscribe: <http://groups.google.com/group/ruby-ffi/subscribe?hl=en_US>,
 <mailto:ruby-ffi+unsubscribe@googlegroups.com>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

On Thu, Sep 2, 2010 at 1:22 PM, Karl <threadhead@gmail.com> wrote:
> Boring Background:
> Let me say first that I'm no Windows expert and it's been 20 years
> since I last compiled anything I wrote in C. But I need to access an
> API on a Windows machine (controls a DAQ board) from Ruby. So I'm
> trying to get the first steps down, compiling a C lib I can access
> through ruby.
>
> Also, I apologize if this is the wrong place to post, but it seems
> that this is the only forum that C extension writers on windows
> frequent.
>
>

Hello Karl

Ruby FFI aims to replace the need to compile an extension to access a
library, please see the wiki:

http://wiki.github.com/ffi/ffi

With examples to access Windows API.

Going to respond your question anyhow, but please read the wiki.

> Can't Compile Simple C DLL:
> Installed Ruby 1.8.7-p302 from rubyinstaller.org (used the .exe).
> Installed DevKit-4.5.0-20100819-1536-sfx.exe from rubyinstaller.org
> Performed the devkit install, all it working (installing gems that
> require compiling work)
>
> Also tried setup up 'fstab' using this site
> http://geeksharp.com/2010/01/18/windows-ruby-native-gems-1-9-1/ but
> nothing he shows looks remotely like my installation. So I set C:
> \devkit\etc\fstab to:
> =A0C:/devkit/mingw/lib/gcc/mingw32/4.5.0 =A0/mingw
>

You don't need to modify the fstab.

>
> Trying to compile the following:
> #stree.c
> #include <ruby.h>
>
> static VALUE hello_world(VALUE klass)
> {
> =A0return rb_str_new2("hello world");
> }
>
> void Init_stree()
> {
> =A0VALUE mStree =3D rb_define_module("Stree");
> =A0rb_define_singleton_method(mStree, "hello_world", hello_world, 0);
> }
>
>
> #extconf.rb
> require 'mkmf'
> create_makefile('stree/stree')
>
>
> On the win machine I run: ruby extconf.rb
> =A0creates the Makefile, no errors
>
> I run: 'make' and receive the following:
> =A0Compile the C Code to a DLL
> =A0'cl' is not recognized as an internal or external command, operable
> program or batch file.
> =A0Could Not Find C:\rails\ext_test\stree\ext\stree\*.obj
> =A0Done.
>

You're using the wrong ruby to compile. Basically you're running Ruby
compiled with mswin32 (Visual C) instead of RubyInstaller.

It trying to look for cl indicates that rbconfig used by your ruby
installation came from mswin32 version.

So, either you installed RubyInstaller on top of another Ruby, or you
modified anything in your installation.

Please try a clean Ruby+DevKit installation.

Also, please read the instructions at our wiki for details on DevKit
installation.

http://github.com/oneclick/rubyinstaller/wiki/Development-Kit
--=20
Luis Lavena
AREA 17
-
Perfection in design is achieved not when there is nothing more to add,
but rather when there is nothing more to take away.
Antoine de Saint-Exup=E9ry
