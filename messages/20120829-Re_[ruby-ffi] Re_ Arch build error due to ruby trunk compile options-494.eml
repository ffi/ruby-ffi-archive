Delivered-To: headius@headius.com
Received: by 10.182.72.202 with SMTP id f10csp197020obv;
        Wed, 29 Aug 2012 09:47:30 -0700 (PDT)
Received: by 10.236.144.137 with SMTP id n9mr2132406yhj.107.1346258846474;
        Wed, 29 Aug 2012 09:47:26 -0700 (PDT)
Return-Path: <ruby-ffi+bncCLeTq4HQChCej_mBBRoE1VRpVw@googlegroups.com>
Received: from mail-gh0-f190.google.com (mail-gh0-f190.google.com [209.85.160.190])
        by mx.google.com with ESMTPS id c29si22564368yhe.117.2012.08.29.09.47.26
        (version=TLSv1/SSLv3 cipher=OTHER);
        Wed, 29 Aug 2012 09:47:26 -0700 (PDT)
Received-SPF: pass (google.com: domain of ruby-ffi+bncCLeTq4HQChCej_mBBRoE1VRpVw@googlegroups.com designates 209.85.160.190 as permitted sender) client-ip=209.85.160.190;
Authentication-Results: mx.google.com; spf=pass (google.com: domain of ruby-ffi+bncCLeTq4HQChCej_mBBRoE1VRpVw@googlegroups.com designates 209.85.160.190 as permitted sender) smtp.mail=ruby-ffi+bncCLeTq4HQChCej_mBBRoE1VRpVw@googlegroups.com; dkim=pass header.i=@googlegroups.com
Received: by ghbz22 with SMTP id z22sf1065800ghb.7
        for <headius@headius.com>; Wed, 29 Aug 2012 09:47:26 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlegroups.com; s=20120806;
        h=x-beenthere:received-spf:date:from:to:subject:message-id
         :in-reply-to:references:x-mailer:mime-version:x-original-sender
         :x-original-authentication-results:reply-to:precedence:mailing-list
         :list-id:x-google-group-id:list-post:list-help:list-archive:sender
         :list-subscribe:list-unsubscribe:content-type
         :content-transfer-encoding;
        bh=FzNry/P9Rpy9abJ9NsID/44qHnuN3m8O2ANS1y/1sYU=;
        b=mu73m75Jcv3HHl/YRaYb9s2fMLsjgrx72H0Vmwkvcs9TMpkf+gNYwtzdQetn1I+la+
         lmQRGIb2nqQJeT/pBKAVwP7fxUr298BOHOOrYIyGXy+nQP2b7u6G7045X8olYNWGmJEC
         m+4gznTnW4ACL7bJVd4OOsMkCQBrI6ZbfWJMmGJg/NSg+nrNYlYtXCWeU7TFa5vQu8wA
         8XQe6eQDYT28PeozNfLQm5H2CczA5NaXPijPSNQ4MxuNKlD9AH4hwHvb3fgW5AGWYUDl
         v1XeDdgbkRObQ3sUjKGUNkOQcyrKspoz0MR2/BwrFjJ1HI0NC39U+iMzuhKYMLsYCwbS
         Xweg==
Received: by 10.68.232.230 with SMTP id tr6mr462699pbc.16.1346258846004;
        Wed, 29 Aug 2012 09:47:26 -0700 (PDT)
X-BeenThere: ruby-ffi@googlegroups.com
Received: by 10.68.210.197 with SMTP id mw5ls6137212pbc.7.gmail; Wed, 29 Aug
 2012 09:47:25 -0700 (PDT)
Received: by 10.68.224.71 with SMTP id ra7mr452764pbc.3.1346258845606;
        Wed, 29 Aug 2012 09:47:25 -0700 (PDT)
Received: by 10.68.224.71 with SMTP id ra7mr452763pbc.3.1346258845595;
        Wed, 29 Aug 2012 09:47:25 -0700 (PDT)
Received: from mail-pb0-f45.google.com (mail-pb0-f45.google.com [209.85.160.45])
        by gmr-mx.google.com with ESMTPS id vo7si560475pbc.1.2012.08.29.09.47.25
        (version=TLSv1/SSLv3 cipher=OTHER);
        Wed, 29 Aug 2012 09:47:25 -0700 (PDT)
Received-SPF: pass (google.com: domain of jon.forums@gmail.com designates 209.85.160.45 as permitted sender) client-ip=209.85.160.45;
Received: by mail-pb0-f45.google.com with SMTP id jt11so1491209pbb.32
        for <ruby-ffi@googlegroups.com>; Wed, 29 Aug 2012 09:47:25 -0700 (PDT)
Received: by 10.68.224.133 with SMTP id rc5mr5708735pbc.130.1346258845425;
        Wed, 29 Aug 2012 09:47:25 -0700 (PDT)
Received: from Red (173-160-200-113-Washington.hfc.comcastbusiness.net. [173.160.200.113])
        by mx.google.com with ESMTPS id b4sm19628276pbw.28.2012.08.29.09.47.20
        (version=TLSv1/SSLv3 cipher=OTHER);
        Wed, 29 Aug 2012 09:47:23 -0700 (PDT)
Date: Wed, 29 Aug 2012 12:47:16 -0400
From: Jon <jon.forums@gmail.com>
To: ruby-ffi@googlegroups.com
Subject: Re: [ruby-ffi] Re: Arch build error due to ruby trunk compile options
Message-Id: <20120829124716.4064138756a135027ace587f@gmail.com>
In-Reply-To: <9fceceb1-f556-4a59-b857-e6fd8b1bf2d4@googlegroups.com>
References: <20120809161610.3f08ab62d25d18c6ddea91fc@gmail.com>
	<cb9f4f35-2aed-4344-b55b-03739a7c8250@googlegroups.com>
	<20120822160359.cba5593fa6711e858b8f8373@gmail.com>
	<20120823122801.0dc8cd3381f5b87f37f0d8a0@gmail.com>
	<9fceceb1-f556-4a59-b857-e6fd8b1bf2d4@googlegroups.com>
X-Mailer: Sylpheed 3.2.0 (GTK+ 2.10.14; i686-pc-mingw32)
Mime-Version: 1.0
X-Original-Sender: jon.forums@gmail.com
X-Original-Authentication-Results: gmr-mx.google.com; spf=pass (google.com:
 domain of jon.forums@gmail.com designates 209.85.160.45 as permitted sender)
 smtp.mail=jon.forums@gmail.com; dkim=pass header.i=@gmail.com
Reply-To: ruby-ffi@googlegroups.com
Precedence: list
Mailing-list: list ruby-ffi@googlegroups.com; contact ruby-ffi+owners@googlegroups.com
List-ID: <ruby-ffi.googlegroups.com>
X-Google-Group-Id: 238405446264
List-Post: <http://groups.google.com/group/ruby-ffi/post?hl=en_US>, <mailto:ruby-ffi@googlegroups.com>
List-Help: <http://groups.google.com/support/?hl=en_US>, <mailto:ruby-ffi+help@googlegroups.com>
List-Archive: <http://groups.google.com/group/ruby-ffi?hl=en_US>
Sender: ruby-ffi@googlegroups.com
List-Subscribe: <http://groups.google.com/group/ruby-ffi/subscribe?hl=en_US>, <mailto:ruby-ffi+subscribe@googlegroups.com>
List-Unsubscribe: <http://groups.google.com/group/ruby-ffi/subscribe?hl=en_US>,
 <mailto:googlegroups-manage+238405446264+unsubscribe@googlegroups.com>
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

Quick smoke tests on my Arch system for `1.1.6.pre1` look good.

[jon@archee ffi-git]$ uname -a
Linux archee 3.5.3-1-ARCH #1 SMP PREEMPT Sun Aug 26 08:15:06 UTC 2012 i686 GNU/Linux

[jon@archee ffi-git]$ gcc --version
gcc (GCC) 4.7.1 20120721 (prerelease)

[jon@archee ffi-git]$ ruby --version
ruby 2.0.0dev (2012-08-29 trunk 36843) [i686-linux]

[jon@archee ffi-git]$ git ilog -3 --oneline
* 2bb63e5 (HEAD, tag: 1.1.6.pre1, origin/ffi-1.1) Bump version to 1.1.6.pre1
* db3d4ec Merge a lot of warning fixes from master
* 3ba0138 Make more dirs based on target stem

[jon@archee ffi-git]$ rake gem
...
cd pkg/ffi-1.1.6.pre1
  Successfully built RubyGem
  Name: ffi
  Version: 1.1.6.pre1
  File: ffi-1.1.6.pre1.gem
mv ffi-1.1.6.pre1.gem ../ffi-1.1.6.pre1.gem

[jon@archee ffi-git]$ gem i pkg/ffi-1.1.6.pre1.gem --user-install
Building native extensions.  This could take a while...
Successfully installed ffi-1.1.6.pre1
1 gem installed

[jon@archee ffi-git]$ ripl -rffi
>> puts $LOADED_FEATURES.grep(/ffi/)
/home/jon/.gem/ruby/2.0.0/gems/ffi-1.1.6.pre1/lib/ffi_c.so
/home/jon/.gem/ruby/2.0.0/gems/ffi-1.1.6.pre1/lib/ffi/platform.rb
...
>> %w[LIBC NAME ADDRESS_SIZE].each { |i| puts eval("FFI::Platform::#{i}") }
libc.so.6
i386-linux
32



> I pushed those changes in 1.2.0.dev4 and 1.1.6.pre1
> 
> It'd be nice if 1.1.6.pre1 in particular got some testing love by people 
> running ruby-head.
> 
> On Friday, 24 August 2012 02:28:01 UTC+10, Jon wrote:
> >
> > :) 
> >
> > [jon@archee ffi-git]$ git log -1 --oneline 
> > 20c243a Add back ffiStatus lvar to rbffi_MethodHandle_Init() 
> >
> > [jon@archee ffi-git]$ gem i pkg/ffi-1.2.0.devmaster.gem --user-install 
> > Building native extensions.  This could take a while... 
> > Successfully installed ffi-1.2.0.devmaster 
> > 1 gem installed 
> >
> >
> > > eek => MethodHandle.c:340:5: error: 'ffiStatus' undeclared (first use in 
> > this function) 
> > > 
> > > 
> > > [jon@archee ~]$ gem i ffi --pre --user-install 
> > > Fetching: ffi-1.2.0.dev3.gem (100%) 
> > > Building native extensions.  This could take a while... 
> > > ERROR:  Error installing ffi: 
> > >         ERROR: Failed to build gem native extension. 
> > > 
> > >         /usr/local/bin/ruby extconf.rb 
> > > checking for ffi_call() in -lffi... yes 
> > > checking for ffi_prep_closure()... yes 
> > > checking for ffi_raw_call()... yes 
> > > checking for ffi_prep_raw_closure()... yes 
> > > checking for rb_thread_blocking_region()... yes 
> > > checking for ruby_native_thread_p()... yes 
> > > checking for rb_thread_call_with_gvl()... yes 
> > > checking for ffi_prep_cif_var()... yes 
> > > creating extconf.h 
> > > creating Makefile 
> > > 
> > > make 
> > > compiling Pointer.c 
> > > compiling Platform.c 
> > > compiling Types.c 
> > > compiling MappedType.c 
> > > compiling Buffer.c 
> > > compiling Call.c 
> > > Call.c: In function 'do_blocking_call': 
> > > Call.c:281:5: warning: 'rb_thread_blocking_region' is deprecated 
> > (declared at /usr/local/include/ruby-2.0.0/ruby/intern.h:823) 
> > [-Wdeprecated-declarations] 
> > > compiling LongDouble.c 
> > > compiling ClosurePool.c 
> > > compiling StructByReference.c 
> > > compiling ArrayType.c 
> > > compiling Variadic.c 
> > > compiling MemoryPointer.c 
> > > compiling Struct.c 
> > > compiling AbstractMemory.c 
> > > compiling MethodHandle.c 
> > > MethodHandle.c: In function 'rbffi_MethodHandle_Init': 
> > > MethodHandle.c:340:5: error: 'ffiStatus' undeclared (first use in this 
> > function) 
> > > MethodHandle.c:340:5: note: each undeclared identifier is reported only 
> > once for each function it appears in 
> > > make: *** [MethodHandle.o] Error 1 
> > > 
> > > 
> > > 
> > > > Can you try 1.2.0.dev3 ?  It should eliminate the warnflags MRI puts 
> > in 
> > > > there. 
> > > > 
> > > > On Friday, 10 August 2012 06:16:10 UTC+10, Jon wrote: 
> > > > > 
> > > > > With ruby trunk the last few ffi gem releases have failed to build 
> > on my 
> > > > > Arch 3.4.7 32bit dev system with gcc 4.7.1 (20120721). 
> > > > > 
> > > > > Given the details and workaround info below, the root cause appears 
> > to be 
> > > > > recent `configure.in` ansi compliance mods: 
> > > > > 
> > > > >   https://github.com/ruby/ruby/blob/trunk/configure.in#L619-635 
> > > > > 
> > > > > Looks like others are running into as well 
> > > > > 
> > > > >   https://github.com/flori/json/issues/142 
> > > > > 
> > > > > While I've only briefly investigated, I don't have time to fully 
> > look into 
> > > > > it. But I don't want to forget about it. 
> > > > > 
> > > > > 
> > > > > 
> > > > > *** GEM UPDATE FAILURE *** 
> > > > > 
> > > > > [jon@archee ~]$ gem update ffi --user-install 
> > > > > Updating installed gems 
> > > > > Updating ffi 
> > > > > Fetching: ffi-1.1.5.gem (100%) 
> > > > > Building native extensions.  This could take a while... 
> > > > > ERROR:  Error installing ffi: 
> > > > >         ERROR: Failed to build gem native extension. 
> > > > > 
> > > > >         /usr/local/bin/ruby extconf.rb 
> > > > > checking for ffi_call() in -lffi... yes 
> > > > > checking for ffi_prep_closure()... yes 
> > > > > checking for ffi_raw_call()... yes 
> > > > > checking for ffi_prep_raw_closure()... yes 
> > > > > checking for rb_thread_blocking_region()... yes 
> > > > > checking for ruby_native_thread_p()... yes 
> > > > > checking for rb_thread_call_with_gvl()... yes 
> > > > > creating extconf.h 
> > > > > creating Makefile 
> > > > > 
> > > > > make 
> > > > > compiling Pointer.c 
> > > > > In file included from Pointer.c:34:0: 
> > > > > rbffi_endian.h:46:4: error: #error "Cannot determine the endian-ness 
> > of 
> > > > > this platform" 
> > > > > Pointer.c: In function 'ptr_order': 
> > > > > Pointer.c:339:59: error: 'BYTE_ORDER' undeclared (first use in this 
> > > > > function) 
> > > > > Pointer.c:339:59: note: each undeclared identifier is reported only 
> > once 
> > > > > for each function it appears in 
> > > > > Pointer.c:339:72: error: 'BIG_ENDIAN' undeclared (first use in this 
> > > > > function) 
> > > > > Pointer.c:351:25: error: 'LITTLE_ENDIAN' undeclared (first use in 
> > this 
> > > > > function) 
> > > > > Pointer.c:368:1: warning: control reaches end of non-void function 
> > > > > [-Wreturn-type] 
> > > > > make: *** [Pointer.o] Error 1 
> > > > > 
> > > > > 
> > > > > Gem files will remain installed in 
> > > > > /home/jon/.gem/ruby/2.0.0/gems/ffi-1.1.5 for inspection. 
> > > > > Results logged to 
> > > > > /home/jon/.gem/ruby/2.0.0/gems/ffi-1.1.5/ext/ffi_c/gem_make.out 
> > > > > Nothing to update 
> > > > > 
> > > > > 
> > > > > 
> > > > > *** WORKAROUND *** 
> > > > > 
> > > > > gem update ffi --user-install -- --with-cflags='--std=gnu99' 
> > > > > 
> > > > > 
> > > > > 
> > > > > *** SYSTEM INFO *** 
> > > > > 
> > > > > # rbconfig.rb contents: 
> > > > >   CONFIG["warnflags"] = "-Wall -Wextra -Wno-unused-parameter 
> > > > > -Wno-parentheses -Wno-long-long -Wno-missing-field-initializers 
> > > > > -Wunused-variable -Werror=pointer-arith -Werror=write-strings 
> > > > > -Werror=declaration-after-statement 
> > -Werror=implicit-function-declaration 
> > > > > -ansi -std=iso9899:199409" 
> > > > >   CONFIG["WERRORFLAG"] = "-Werror" 
> > > > > 
> > > > > 
> > > > > [jon@archee ~]$ gem env 
> > > > > RubyGems Environment: 
> > > > >   - RUBYGEMS VERSION: 1.8.24 
> > > > >   - RUBY VERSION: 2.0.0 (2012-08-10 patchlevel -1) [i686-linux] 
> > > > >   - INSTALLATION DIRECTORY: /usr/local/lib/ruby/gems/2.0.0 
> > > > >   - RUBY EXECUTABLE: /usr/local/bin/ruby 
> > > > >   - EXECUTABLE DIRECTORY: /usr/local/bin 
> > > > >   - RUBYGEMS PLATFORMS: 
> > > > >     - ruby 
> > > > >     - x86-linux 
> > > > >   - GEM PATHS: 
> > > > >      - /usr/local/lib/ruby/gems/2.0.0 
> > > > >      - /home/jon/.gem/ruby/2.0.0 
> > > > >   - GEM CONFIGURATION: 
> > > > >      - :update_sources => true 
> > > > >      - :verbose => true 
> > > > >      - :benchmark => false 
> > > > >      - :backtrace => false 
> > > > >      - :bulk_threshold => 1000 
> > > > >      - :sources => ["http://rubygems.org"] 
> > > > >      - "gem" => "--no-ri --no-rdoc" 
> > > > >   - REMOTE SOURCES: 
> > > > >      - http://rubygems.org 
> > > > > 
> > > > > 
> > > > > Jon 
> > > > > 
> > > > > --- 
> > > > > Fail fast. Fail often. Fail publicly. Learn. Adapt. Repeat. 
> > > > > http://thecodeshop.github.com | http://jonforums.github.com/ 
> > > > > twitter: @jonforums 
> > > > > 
> > > 
> > > 
> > > Jon 
> > > 
> > > --- 
> > > Fail fast. Fail often. Fail publicly. Learn. Adapt. Repeat. 
> > > http://thecodeshop.github.com | http://jonforums.github.com/ 
> > > twitter: @jonforums 
> >
> >
> > Jon 
> >
> > --- 
> > Fail fast. Fail often. Fail publicly. Learn. Adapt. Repeat. 
> > http://thecodeshop.github.com | http://jonforums.github.com/ 
> > twitter: @jonforums 
> >


Jon

---
Fail fast. Fail often. Fail publicly. Learn. Adapt. Repeat.
http://thecodeshop.github.com | http://jonforums.github.com/
twitter: @jonforums
