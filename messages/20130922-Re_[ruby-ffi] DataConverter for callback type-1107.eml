Delivered-To: headius@headius.com
Received: by 10.152.9.8 with SMTP id v8csp143593laa;
        Sun, 22 Sep 2013 12:37:27 -0700 (PDT)
X-Received: by 10.15.33.132 with SMTP id c4mr30944480eev.2.1379878647514;
        Sun, 22 Sep 2013 12:37:27 -0700 (PDT)
Return-Path: <ruby-ffi+bncBD6733FW44FBB5UN7WIQKGQEHN2TZYY@googlegroups.com>
Received: from mail-ee0-x23d.google.com (mail-ee0-x23d.google.com [2a00:1450:4013:c00::23d])
        by mx.google.com with ESMTPS id z8si19661601eee.173.1969.12.31.16.00.00
        (version=TLSv1 cipher=ECDHE-RSA-RC4-SHA bits=128/128);
        Sun, 22 Sep 2013 12:37:27 -0700 (PDT)
Received-SPF: softfail (google.com: domain of transitioning ruby-ffi+bncBD6733FW44FBB5UN7WIQKGQEHN2TZYY@googlegroups.com does not designate 194.109.24.35 as permitted sender) client-ip=194.109.24.35;
Authentication-Results: mx.google.com;
       spf=softfail (google.com: domain of transitioning ruby-ffi+bncBD6733FW44FBB5UN7WIQKGQEHN2TZYY@googlegroups.com does not designate 194.109.24.35 as permitted sender) smtp.mail=ruby-ffi+bncBD6733FW44FBB5UN7WIQKGQEHN2TZYY@googlegroups.com;
       dkim=pass header.i=@googlegroups.com
Received: by mail-ee0-f61.google.com with SMTP id d51sf286893eek.6
        for <headius@headius.com>; Sun, 22 Sep 2013 12:37:27 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlegroups.com; s=20120806;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:content-type:x-original-sender
         :x-original-authentication-results:reply-to:precedence:mailing-list
         :list-id:list-post:list-help:list-archive:sender:list-subscribe
         :list-unsubscribe;
        bh=JeypAkG31oXwHril16E2gvdxFU43WfRlU5XD9WTeS+Q=;
        b=wnOmFVtPuX20mCQOelWKzfo6Nt78BTaL1bJb8QHUsp8rq9+pih1cTWYyoO1vFQxw+a
         Wgw0CZFTRjxX9lUVT45EighEc1P4QmWafI4vR/VFb8QQ9EeXwa4CPxSe4G5koRXEsDZ9
         sby9kwvV5MdiI8ALnbMNzHo8P198u/ynlmxMyKuPF6ap5Y3O/bT3wAFWBBZ9YOJZZXw5
         fXgj+q8Wgo38aTuk8mTDy+2wMyBtRjEGqnDxmGHdHGlUg1X7UJ+tHYIAsAIpdE6sy3pU
         wT+RlmSyPRE+yhkWrSUBZKpg7vQj3LN4R6YWGRVYEpFla3HpHg/yIXd/C2Qt6ep0NONl
         Equg==
X-Received: by 10.180.11.239 with SMTP id t15mr342869wib.15.1379878647191;
        Sun, 22 Sep 2013 12:37:27 -0700 (PDT)
X-BeenThere: ruby-ffi@googlegroups.com
Received: by 10.180.188.100 with SMTP id fz4ls500671wic.29.gmail; Sun, 22 Sep
 2013 12:37:26 -0700 (PDT)
X-Received: by 10.14.251.134 with SMTP id b6mr16061579ees.2.1379878646582;
        Sun, 22 Sep 2013 12:37:26 -0700 (PDT)
Received: from smtp-vbr15.xs4all.nl (smtp-vbr15.xs4all.nl. [194.109.24.35])
        by gmr-mx.google.com with ESMTP id a1si3536222ees.1.1969.12.31.16.00.00;
        Sun, 22 Sep 2013 12:37:26 -0700 (PDT)
Received-SPF: neutral (google.com: 194.109.24.35 is neither permitted nor denied by best guess record for domain of matijs@matijs.net) client-ip=194.109.24.35;
Received: from [10.0.0.34] (mvz.xs4all.nl [83.163.118.181])
	(authenticated bits=0)
	by smtp-vbr15.xs4all.nl (8.13.8/8.13.8) with ESMTP id r8MJbNLL006862
	(version=TLSv1/SSLv3 cipher=DHE-RSA-AES256-SHA bits=256 verify=NO)
	for <ruby-ffi@googlegroups.com>; Sun, 22 Sep 2013 21:37:25 +0200 (CEST)
	(envelope-from matijs@matijs.net)
Message-ID: <523F46F3.1070005@matijs.net>
Date: Sun, 22 Sep 2013 21:37:23 +0200
From: Matijs van Zuijlen <matijs@matijs.net>
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:17.0) Gecko/20130821 Icedove/17.0.8
MIME-Version: 1.0
To: ruby-ffi@googlegroups.com
Subject: Re: [ruby-ffi] DataConverter for callback type
References: <523ECEE1.4060406@matijs.net>
In-Reply-To: <523ECEE1.4060406@matijs.net>
X-Enigmail-Version: 1.5.1
Content-Type: multipart/signed; micalg=pgp-sha256;
 protocol="application/pgp-signature";
 boundary="----enig2FWGGWIDMUOOEHPSMHKBU"
X-Virus-Scanned: by XS4ALL Virus Scanner
X-Original-Sender: matijs@matijs.net
X-Original-Authentication-Results: gmr-mx.google.com;       spf=neutral
 (google.com: 194.109.24.35 is neither permitted nor denied by best guess
 record for domain of matijs@matijs.net) smtp.mail=matijs@matijs.net
Reply-To: ruby-ffi@googlegroups.com
Precedence: list
Mailing-list: list ruby-ffi@googlegroups.com; contact ruby-ffi+owners@googlegroups.com
List-ID: <ruby-ffi.googlegroups.com>
X-Google-Group-Id: 238405446264
List-Post: <http://groups.google.com/group/ruby-ffi/post>, <mailto:ruby-ffi@googlegroups.com>
List-Help: <http://groups.google.com/support/>, <mailto:ruby-ffi+help@googlegroups.com>
List-Archive: <http://groups.google.com/group/ruby-ffi>
Sender: ruby-ffi@googlegroups.com
List-Subscribe: <http://groups.google.com/group/ruby-ffi/subscribe>, <mailto:ruby-ffi+subscribe@googlegroups.com>
List-Unsubscribe: <http://groups.google.com/group/ruby-ffi/subscribe>, <mailto:googlegroups-manage+238405446264+unsubscribe@googlegroups.com>

This is an OpenPGP/MIME signed message (RFC 4880 and 3156)
------enig2FWGGWIDMUOOEHPSMHKBU
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

I've been digging a little further, and it seems that the rbffi_Function_=
ForProc
function defined in Function.c does exactly what I want, since I have a
FFI::FunctionType (i.e., self::Callback), and a Proc (the value argument =
of
#to_native), and I would like to turn this into a FFI::Function.

Would it be possible to expose this function to Ruby?

On 22/09/13 13:05, Matijs van Zuijlen wrote:
> Hello,
>=20
> I'm trying to create a DataConverter that represents a callback functio=
n. The
> code basically boils down to this:
>=20
> module Lib
>   include FFI::Library
>   ffi_lib 'some-library'
> end
>=20
> class Foo < Proc
>   extend FFI::DataConverter
>=20
>   Callback =3D Lib.callback ... # usual call to FFI::Library.callback
>=20
>   def self.native_type
>     self::Callback
>   end
> end
>=20
> [The reason I'm doing this is that I want to wrap procs passed from rub=
y in some
> argument conversion code using a method defined on, in this case, Foo]
>=20
> Now, I'm unable to figure out what the definition of Foo.to_native shou=
ld be.
> Foo::Callback is of type FFI::FunctionType, which doesn't have a to_nat=
ive method.
>=20
> Any ideas?
>=20
> Thanks and regards,
>=20


--=20
Matijs


------enig2FWGGWIDMUOOEHPSMHKBU
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: OpenPGP digital signature
Content-Disposition: attachment; filename="signature.asc"

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.14 (GNU/Linux)

iQEVAwUBUj9G85Z5CSFec8nfAQi17Qf/VdlKkP0QMIb1pYHfogFvD2XzJfRfrvKB
2lhmA4e+EiyrjxXJOgvqm/bODSJR2knO9hUOS/3J5r5GXZ7CJt0VM2ldwYVe1aoq
NBFnlohe03vbCtFU0MG0YouVM1Hs9e+TwzDhxqJHK09fGytIftzcN/N0twr2NSMt
gnrq1FGBTbwqhzSlI357+V37R6UgIkSI4OxEImK4CUiV1tI44TonqjyxoP9vHYss
GZ0yJ4pAPCGW09zj1FttETf5MN6i/nnlQTPBCXdtc2MMJJrwxtwhEtCL0pFY2ajq
8CC+RlvOoreIQf89E7MuzGAtOrtC0+yDGvFwJt8Hm+xNLh2+Ldv7yg==
=OX0T
-----END PGP SIGNATURE-----

------enig2FWGGWIDMUOOEHPSMHKBU--
