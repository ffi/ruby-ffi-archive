<html>
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>[ruby-ffi] can&#39;t explain this behavior</title>
<link rel="important stylesheet" href="">
<style>div.headerdisplayname {font-weight:bold;}</style></head>
<body>
<table border=0 cellspacing=0 cellpadding=0 width="100%" class="header-part1"><tr><td><div class="headerdisplayname" style="display:inline;">Subject: </div>[ruby-ffi] can&#39;t explain this behavior</td></tr><tr><td><div class="headerdisplayname" style="display:inline;">From: </div>Alexander Kabanov <shurikk@gmail.com></td></tr><tr><td><div class="headerdisplayname" style="display:inline;">Date: </div>4/20/11 1:12 PM</td></tr></table><table border=0 cellspacing=0 cellpadding=0 width="100%" class="header-part2"><tr><td><div class="headerdisplayname" style="display:inline;">To: </div>ruby-ffi <ruby-ffi@googlegroups.com></td></tr></table><br>
<div class="moz-text-plain" wrap=true graphical-quote=true style="font-family: -moz-fixed; font-size: 12px;" lang="x-western"><pre wrap>
Hi there,

I'm trying to do something basic in my opinion, and get mixed results

code example is here: <a class="moz-txt-link-freetext" href="http://pastebin.com/b15rrd6n">http://pastebin.com/b15rrd6n</a>

C function signature (arguments in order):

- pointer to a string (input)
- string size
- pointer to final result (string)
- pointer to result size (int)
- int (always 0 now)
- pointer to a string

sometimes function call works as expected, sometimes it doesn't, I
can't explain why. adding removing few lines of code (random "puts"
calls etc.) will change the function call behavior (will work 20% or
100% of times). am I supposed to maintain memory pointers somehow
(i.e. malloc/free) or my .so lib has bad implementation (i know it's
used in other places without any issues)?

I tried to use LibC approach described on wiki page using malloc, same
deal.

ruby 1.8.7 (2010-12-23 patchlevel 330) [i386-linux] RHEL 5.4
ffi (1.0.7)

best,

--Alex
</pre></div></body>
</html>
</table></div>