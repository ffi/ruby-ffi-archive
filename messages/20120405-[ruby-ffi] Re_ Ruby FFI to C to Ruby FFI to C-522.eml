Delivered-To: headius@headius.com
Received: by 10.182.47.194 with SMTP id f2csp36878obn;
        Thu, 5 Apr 2012 16:11:47 -0700 (PDT)
Received: by 10.68.197.3 with SMTP id iq3mr2250862pbc.36.1333667506014;
        Thu, 05 Apr 2012 16:11:46 -0700 (PDT)
Return-Path: <ruby-ffi+bncCJHz69weEKzN-PsEGgRtqxqQ@googlegroups.com>
Received: from mail-pz0-f62.google.com (mail-pz0-f62.google.com [209.85.210.62])
        by mx.google.com with ESMTPS id jw2si242639pbc.58.2012.04.05.16.11.45
        (version=TLSv1/SSLv3 cipher=OTHER);
        Thu, 05 Apr 2012 16:11:46 -0700 (PDT)
Received-SPF: pass (google.com: domain of ruby-ffi+bncCJHz69weEKzN-PsEGgRtqxqQ@googlegroups.com designates 209.85.210.62 as permitted sender) client-ip=209.85.210.62;
Authentication-Results: mx.google.com; spf=pass (google.com: domain of ruby-ffi+bncCJHz69weEKzN-PsEGgRtqxqQ@googlegroups.com designates 209.85.210.62 as permitted sender) smtp.mail=ruby-ffi+bncCJHz69weEKzN-PsEGgRtqxqQ@googlegroups.com; dkim=pass header.i=@googlegroups.com
Received: by dadp14 with SMTP id p14sf3112790dad.7
        for <headius@headius.com>; Thu, 05 Apr 2012 16:11:45 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlegroups.com; s=beta;
        h=x-beenthere:received-spf:mime-version:in-reply-to:references:date
         :message-id:subject:from:to:x-original-sender
         :x-original-authentication-results:reply-to:precedence:mailing-list
         :list-id:x-google-group-id:list-post:list-help:list-archive:sender
         :list-subscribe:list-unsubscribe:content-type;
        bh=unURZvKFeQLn9rOzscsxg/mWeOlLhbv0IwxZdoqN6Qk=;
        b=hfAIpYBbaIzeftA1Rnhz6Uz4xeyow5NOSDMd8YuKGgCrQcdzRySLL4b9GeOzon6ldo
         BDzc/2yaQRlYtIByCJ9fdvbL+Gr4ZK10Bx1A8O+udHCTCeIQdotkWyDKKt/osgR8FSvd
         /CQmaF6AegR4/Jijx57nkyB4K2fze6+dSm/hk=
Received: by 10.224.193.200 with SMTP id dv8mr632116qab.7.1333667500617;
        Thu, 05 Apr 2012 16:11:40 -0700 (PDT)
X-BeenThere: ruby-ffi@googlegroups.com
Received: by 10.229.136.134 with SMTP id r6ls303410qct.8.gmail; Thu, 05 Apr
 2012 16:11:40 -0700 (PDT)
Received: by 10.224.173.70 with SMTP id o6mr2597859qaz.2.1333667500069;
        Thu, 05 Apr 2012 16:11:40 -0700 (PDT)
Received: by 10.224.180.136 with SMTP id bu8msqab;
        Thu, 5 Apr 2012 15:30:49 -0700 (PDT)
Received: by 10.236.118.37 with SMTP id k25mr5968171yhh.3.1333665049299;
        Thu, 05 Apr 2012 15:30:49 -0700 (PDT)
Received: by 10.236.118.37 with SMTP id k25mr5968170yhh.3.1333665049280;
        Thu, 05 Apr 2012 15:30:49 -0700 (PDT)
Received: from mail-gy0-f176.google.com (mail-gy0-f176.google.com [209.85.160.176])
        by gmr-mx.google.com with ESMTPS id b69si4645488yhe.0.2012.04.05.15.30.49
        (version=TLSv1/SSLv3 cipher=OTHER);
        Thu, 05 Apr 2012 15:30:49 -0700 (PDT)
Received-SPF: pass (google.com: domain of mallluhuct@gmail.com designates 209.85.160.176 as permitted sender) client-ip=209.85.160.176;
Received: by mail-gy0-f176.google.com with SMTP id z10so1111181ghb.7
        for <ruby-ffi@googlegroups.com>; Thu, 05 Apr 2012 15:30:49 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.236.176.197 with SMTP id b45mr4378339yhm.72.1333665049162;
 Thu, 05 Apr 2012 15:30:49 -0700 (PDT)
Received: by 10.147.145.20 with HTTP; Thu, 5 Apr 2012 15:30:49 -0700 (PDT)
In-Reply-To: <14fe67cd-34b3-400f-aaf1-e1ef26d76661@vy8g2000pbc.googlegroups.com>
References: <14fe67cd-34b3-400f-aaf1-e1ef26d76661@vy8g2000pbc.googlegroups.com>
Date: Thu, 5 Apr 2012 15:30:49 -0700
Message-ID: <CAKVp7b1oAT=4gXjjXQJ4cZuqZp3NpyL5m7ZCfzwa+d7Gq+DSTg@mail.gmail.com>
Subject: [ruby-ffi] Re: Ruby FFI to C to Ruby FFI to C
From: Bulat Shakirzyanov <mallluhuct@gmail.com>
To: ruby-ffi <ruby-ffi@googlegroups.com>
X-Original-Sender: mallluhuct@gmail.com
X-Original-Authentication-Results: gmr-mx.google.com; spf=pass (google.com:
 domain of mallluhuct@gmail.com designates 209.85.160.176 as permitted sender)
 smtp.mail=mallluhuct@gmail.com; dkim=pass header.i=@gmail.com
Reply-To: ruby-ffi@googlegroups.com
Precedence: list
Mailing-list: list ruby-ffi@googlegroups.com; contact ruby-ffi+owners@googlegroups.com
List-ID: <ruby-ffi.googlegroups.com>
X-Google-Group-Id: 238405446264
List-Post: <http://groups.google.com/group/ruby-ffi/post?hl=en_US>, <mailto:ruby-ffi@googlegroups.com>
List-Help: <http://groups.google.com/support/?hl=en_US>, <mailto:ruby-ffi+help@googlegroups.com>
List-Archive: <http://groups.google.com/group/ruby-ffi?hl=en_US>
Sender: ruby-ffi@googlegroups.com
List-Subscribe: <http://groups.google.com/group/ruby-ffi/subscribe?hl=en_US>, <mailto:ruby-ffi+subscribe@googlegroups.com>
List-Unsubscribe: <http://groups.google.com/group/ruby-ffi/subscribe?hl=en_US>,
 <mailto:googlegroups-manage+238405446264+unsubscribe@googlegroups.com>
Content-Type: multipart/alternative; boundary=20cf305b12868133b504bcf61714

--20cf305b12868133b504bcf61714
Content-Type: text/plain; charset=ISO-8859-1

Forgot to clarify that the same issue appears with FFI versions 1.1.0.rc2
and 1.0.11

On Thu, Apr 5, 2012 at 2:50 PM, avalanche123 <mallluhuct@gmail.com> wrote:

> Hello,
>
> I'm working on libuv ffi bindings for Ruby and have an issue I can't
> understand
>
> Libuv needs an allocated buffer it can write to, here is a gist of
> code https://gist.github.com/2313277 that has my ruby module and usage
> examples both in C and Ruby
> The C example works fine, while ruby makes Libuv raise EINVAL. I've
> used some basic debugging and figured out that the buffer len than
> comes from Ruby is 140735085305696
> instead of 128, as can be seen from shell outputs examples I've added
> to the gist. I've also added relevant pieces of Libuv to the gist,
> specifically uv_buf_init that is
> responsible for creating uv_buf_t and part of libuv's uv__read that is
> responsible for using it.
>
> From my debugging it looks like a corrupted uv_buf_t memory comes back
> from Ruby, making libuv believe beffer's len attribute is
> 140735085305696 bytes long.
>
> I will appreciate any feedback as I've been struggling with this for a
> while.
>
> Best,
> Bulat




-- 
*Bulat Shakirzyanov* | Software Alchemist

*a: *about.me/avalanche123
*e:* mallluhuct@gmail.com

--20cf305b12868133b504bcf61714
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Forgot to clarify that the same issue appears with FFI=A0versions=A01.1.0.r=
c2 and=A01.0.11<br><br><div class=3D"gmail_quote">On Thu, Apr 5, 2012 at 2:=
50 PM, avalanche123 <span dir=3D"ltr">&lt;<a href=3D"mailto:mallluhuct@gmai=
l.com">mallluhuct@gmail.com</a>&gt;</span> wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">Hello,<br>
<br>
I&#39;m working on libuv ffi bindings for Ruby and have an issue I can&#39;=
t<br>
understand<br>
<br>
Libuv needs an allocated buffer it can write to, here is a gist of<br>
code <a href=3D"https://gist.github.com/2313277" target=3D"_blank">https://=
gist.github.com/2313277</a> that has my ruby module and usage<br>
examples both in C and Ruby<br>
The C example works fine, while ruby makes Libuv raise EINVAL. I&#39;ve<br>
used some basic debugging and figured out that the buffer len than<br>
comes from Ruby is 140735085305696<br>
instead of 128, as can be seen from shell outputs examples I&#39;ve added<b=
r>
to the gist. I&#39;ve also added relevant pieces of Libuv to the gist,<br>
specifically uv_buf_init that is<br>
responsible for creating uv_buf_t and part of libuv&#39;s uv__read that is<=
br>
responsible for using it.<br>
<br>
 From my debugging it looks like a corrupted uv_buf_t memory comes back<br>
from Ruby, making libuv believe beffer&#39;s len attribute is<br>
140735085305696 bytes long.<br>
<br>
I will appreciate any feedback as I&#39;ve been struggling with this for a<=
br>
while.<br>
<br>
Best,<br>
Bulat</blockquote></div><br><br clear=3D"all"><div><br></div>-- <br><b>Bula=
t Shakirzyanov</b> | <font color=3D"#999999">Software Alchemist</font><div>=
<font color=3D"#999999"><br></font></div><div><div><font face=3D"&#39;couri=
er new&#39;, monospace"><b>a:=A0</b><a href=3D"http://about.me/avalanche123=
" target=3D"_blank">about.me/avalanche123</a></font></div>
<div><span style=3D"font-family:&#39;courier new&#39;,monospace"><b>e:</b>=
=A0<a href=3D"mailto:mallluhuct@gmail.com" target=3D"_blank">mallluhuct@gma=
il.com</a></span></div></div><br>

--20cf305b12868133b504bcf61714--
