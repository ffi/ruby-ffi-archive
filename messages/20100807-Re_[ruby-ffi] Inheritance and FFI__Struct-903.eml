Delivered-To: headius@headius.com
Received: by 10.224.60.79 with SMTP id o15cs239271qah;
        Sat, 7 Aug 2010 12:10:58 -0700 (PDT)
Received: by 10.216.179.20 with SMTP id g20mr11971489wem.45.1281208257568;
        Sat, 07 Aug 2010 12:10:57 -0700 (PDT)
Return-Path: <ruby-ffi+bncCMPYuayYERC_3_biBBoE7H_-Vg@googlegroups.com>
Received: from mail-wy0-f190.google.com (mail-wy0-f190.google.com [74.125.82.190])
        by mx.google.com with ESMTP id z72si4439839weq.131.2010.08.07.12.10.56;
        Sat, 07 Aug 2010 12:10:56 -0700 (PDT)
Received-SPF: pass (google.com: domain of ruby-ffi+bncCMPYuayYERC_3_biBBoE7H_-Vg@googlegroups.com designates 74.125.82.190 as permitted sender) client-ip=74.125.82.190;
Authentication-Results: mx.google.com; spf=pass (google.com: domain of ruby-ffi+bncCMPYuayYERC_3_biBBoE7H_-Vg@googlegroups.com designates 74.125.82.190 as permitted sender) smtp.mail=ruby-ffi+bncCMPYuayYERC_3_biBBoE7H_-Vg@googlegroups.com; dkim=pass (test mode) header.i=@googlegroups.com
Received: by wyb34 with SMTP id 34sf2792441wyb.7
        for <headius@headius.com>; Sat, 07 Aug 2010 12:10:56 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlegroups.com; s=beta;
        h=domainkey-signature:received:x-beenthere:received:received:received
         :received:received-spf:received:mime-version:received:received
         :in-reply-to:references:date:message-id:subject:from:to
         :x-original-sender:x-original-authentication-results:reply-to
         :precedence:mailing-list:list-id:list-post:list-help:list-archive
         :sender:list-subscribe:list-unsubscribe:content-type;
        bh=pxDuwAXYuNBZWI3uihqzGNK3zQcW7K+1pSNqvP4VOzE=;
        b=lwROyljRca3jlZWkhcD+LqBk/xxJgovTRfTjcjvQpkZSCM1+YpU0G8IzfA9MHK65/P
         GmpzG8LiY4gzngpjy7BMNKB80JkU30xUms8N+pbRR+aVf7UMDGKmvOy+fz+S6nsdCByt
         frgIqQh0GJN2M2ZLdQxShNO7NzCW2PbyJdI3k=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlegroups.com; s=beta;
        h=x-beenthere:received-spf:mime-version:in-reply-to:references:date
         :message-id:subject:from:to:x-original-sender
         :x-original-authentication-results:reply-to:precedence:mailing-list
         :list-id:list-post:list-help:list-archive:sender:list-subscribe
         :list-unsubscribe:content-type;
        b=qFJaGm7eRPRxIl9Rv8Opl+FLAzfGa/nI1ErOwh70XGAOQaZ/QLhnz6Qb5hyOjiV/cN
         NTaDzRqeMo4/MeQEIxdNY660EignjFZVKhl8mr2hTh9VDMYULNbfN316k/NnM/GadvUb
         61S8O/YfU0M9G7msfNAzkdzKk0un8TEcxp5Kc=
Received: by 10.216.144.25 with SMTP id m25mr3021217wej.24.1281208255730;
        Sat, 07 Aug 2010 12:10:55 -0700 (PDT)
X-BeenThere: ruby-ffi@googlegroups.com
Received: by 10.227.156.141 with SMTP id x13ls1468701wbw.2.p; Sat, 07 Aug 2010 
	12:10:53 -0700 (PDT)
Received: by 10.227.146.203 with SMTP id i11mr601362wbv.22.1281208253844;
        Sat, 07 Aug 2010 12:10:53 -0700 (PDT)
Received: by 10.227.146.203 with SMTP id i11mr601361wbv.22.1281208253817;
        Sat, 07 Aug 2010 12:10:53 -0700 (PDT)
Received: from mail-wy0-f169.google.com (mail-wy0-f169.google.com [74.125.82.169])
        by gmr-mx.google.com with ESMTP id x32si545281wbd.6.2010.08.07.12.10.52;
        Sat, 07 Aug 2010 12:10:52 -0700 (PDT)
Received-SPF: pass (google.com: domain of jvoorhis@gmail.com designates 74.125.82.169 as permitted sender) client-ip=74.125.82.169;
Received: by mail-wy0-f169.google.com with SMTP id 36so9969438wyg.0
        for <ruby-ffi@googlegroups.com>; Sat, 07 Aug 2010 12:10:52 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.216.231.83 with SMTP id k61mr858600weq.88.1281208252602; Sat,
 07 Aug 2010 12:10:52 -0700 (PDT)
Received: by 10.216.8.3 with HTTP; Sat, 7 Aug 2010 12:10:52 -0700 (PDT)
In-Reply-To: <4C5D5B59.5040200@matijs.net>
References: <4C5D5B59.5040200@matijs.net>
Date: Sat, 7 Aug 2010 12:10:52 -0700
Message-ID: <AANLkTinNFSbLU3t=KgWEuPajCaVFGUm++=1qMtjDms0q@mail.gmail.com>
Subject: Re: [ruby-ffi] Inheritance and FFI::Struct
From: Jeremy Voorhis <jvoorhis@gmail.com>
To: ruby-ffi@googlegroups.com
X-Original-Sender: jvoorhis@gmail.com
X-Original-Authentication-Results: gmr-mx.google.com; spf=pass (google.com: 
	domain of jvoorhis@gmail.com designates 74.125.82.169 as permitted sender) 
	smtp.mail=jvoorhis@gmail.com; dkim=pass (test mode) header.i=@gmail.com
Reply-To: ruby-ffi@googlegroups.com
Precedence: list
Mailing-list: list ruby-ffi@googlegroups.com; contact ruby-ffi+owners@googlegroups.com
List-ID: <ruby-ffi.googlegroups.com>
List-Post: <http://groups.google.com/group/ruby-ffi/post?hl=en_US>, 
	<mailto:ruby-ffi@googlegroups.com>
List-Help: <http://groups.google.com/support/?hl=en_US>, <mailto:ruby-ffi+help@googlegroups.com>
List-Archive: <http://groups.google.com/group/ruby-ffi?hl=en_US>
Sender: ruby-ffi@googlegroups.com
List-Subscribe: <http://groups.google.com/group/ruby-ffi/subscribe?hl=en_US>, 
	<mailto:ruby-ffi+subscribe@googlegroups.com>
List-Unsubscribe: <http://groups.google.com/group/ruby-ffi/subscribe?hl=en_US>, 
	<mailto:ruby-ffi+unsubscribe@googlegroups.com>
Content-Type: multipart/alternative; boundary=000e0cd51636c79bd4048d408ac2

--000e0cd51636c79bd4048d408ac2
Content-Type: text/plain; charset=UTF-8

I would try using composition instead of inheritance in this situation.
Class Bar could descend directly from FFI::Struct instead and have its own
layout. You could use the Forwardable mixin to declare delegate methods that
rely on Bar#p.

Best

Jeremy

On Sat, Aug 7, 2010 at 6:10 AM, Matijs van Zuijlen <matijs@matijs.net>wrote:

> Hello all,
>
> I'm trying to set up an inheritance chain that ultimately inherits from
> FFI::Struct. However, the derived classes have a different layouts. This
> results in warnings about class variables being overridden.
>
> The following code demonstrates the problem when run with ruby -w:
>
>  require 'ffi'
>
>  class Foo < FFI::Struct
>    layout :a, :int, :b, :int
>  end
>
>  class Bar < Foo
>    layout :p, Foo, :c, :int
>  end
>
>  bar = Bar.new
>
> I could set up separate Foo::Struct and Bar::Struct classes to avoid this
> problem, but I'd rather not, as it introduces a lot of extra complexity.
>
> Any thoughts?
>
> Regards,
> --
> Matijs
>

--000e0cd51636c79bd4048d408ac2
Content-Type: text/html; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

I would try using composition instead of inheritance in this situation. Cla=
ss Bar could descend directly from FFI::Struct instead and have its own lay=
out. You could use the Forwardable mixin to declare delegate methods that r=
ely on Bar#p.<div>
<br></div><div>Best</div><div><br></div><div>Jeremy<br><br><div class=3D"gm=
ail_quote">On Sat, Aug 7, 2010 at 6:10 AM, Matijs van Zuijlen <span dir=3D"=
ltr">&lt;<a href=3D"mailto:matijs@matijs.net">matijs@matijs.net</a>&gt;</sp=
an> wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex;">Hello all,<br>
<br>
I&#39;m trying to set up an inheritance chain that ultimately inherits from=
 FFI::Struct. However, the derived classes have a different layouts. This r=
esults in warnings about class variables being overridden.<br>
<br>
The following code demonstrates the problem when run with ruby -w:<br>
<br>
 =C2=A0require &#39;ffi&#39;<br>
<br>
 =C2=A0class Foo &lt; FFI::Struct<br>
 =C2=A0 =C2=A0layout :a, :int, :b, :int<br>
 =C2=A0end<br>
<br>
 =C2=A0class Bar &lt; Foo<br>
 =C2=A0 =C2=A0layout :p, Foo, :c, :int<br>
 =C2=A0end<br>
<br>
 =C2=A0bar =3D Bar.new<br>
<br>
I could set up separate Foo::Struct and Bar::Struct classes to avoid this p=
roblem, but I&#39;d rather not, as it introduces a lot of extra complexity.=
<br>
<br>
Any thoughts?<br>
<br>
Regards,<br>
-- <br><font color=3D"#888888">
Matijs<br>
</font></blockquote></div><br></div>

--000e0cd51636c79bd4048d408ac2--
