Delivered-To: headius@headius.com
Received: by 10.152.9.8 with SMTP id v8csp32584laa;
        Sat, 28 Sep 2013 16:58:06 -0700 (PDT)
X-Received: by 10.49.63.39 with SMTP id d7mr18839482qes.78.1380412686294;
        Sat, 28 Sep 2013 16:58:06 -0700 (PDT)
Return-Path: <ruby-ffi+bncBCJKBQX2REGRBDO2TWJAKGQE6O3IPDA@googlegroups.com>
Received: from mail-qc0-x23c.google.com (mail-qc0-x23c.google.com [2607:f8b0:400d:c01::23c])
        by mx.google.com with ESMTPS id 7si7468574qaw.141.1969.12.31.16.00.00
        (version=TLSv1 cipher=ECDHE-RSA-RC4-SHA bits=128/128);
        Sat, 28 Sep 2013 16:58:06 -0700 (PDT)
Received-SPF: pass (google.com: domain of ruby-ffi+bncBCJKBQX2REGRBDO2TWJAKGQE6O3IPDA@googlegroups.com designates 2607:f8b0:400d:c01::23c as permitted sender)
Authentication-Results: mx.google.com;
       spf=pass (google.com: domain of ruby-ffi+bncBCJKBQX2REGRBDO2TWJAKGQE6O3IPDA@googlegroups.com designates 2607:f8b0:400d:c01::23c as permitted sender) smtp.mail=ruby-ffi+bncBCJKBQX2REGRBDO2TWJAKGQE6O3IPDA@googlegroups.com;
       dkim=pass header.i=@googlegroups.com
Received: by mail-qc0-f188.google.com with SMTP id i17sf835319qcy.15
        for <headius@headius.com>; Sat, 28 Sep 2013 16:58:05 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlegroups.com; s=20120806;
        h=date:from:to:message-id:in-reply-to:references:subject:mime-version
         :x-original-sender:reply-to:precedence:mailing-list:list-id
         :list-post:list-help:list-archive:sender:list-subscribe
         :list-unsubscribe:content-type;
        bh=djV8gx/Mm27uLYIbRwS/wfdA21/UWOlY1NgbQC9bRG0=;
        b=u/FXV4EZhQud2a/+4bd1esTLkmbNNVj4Ib+R3PEqo6UZvd97l/tcxlUPN18gc6hAcS
         LTPpMbTT71hMOLqPhQYND5y9WsnQpPndZTs1OH9M6X7BwzS24luVdthlBylxJLQxlxAe
         BVi3ST4KlASWJC55YSZ5VshiV3rtFzcIfnMF3Gk4vNB3oEJyenZY7ugIbMPlUputBPtP
         m8m7B3MmVU++ShFtUz00BYS6l5fBG34TjwnKrtfe9oLB3gH+Y9gOiZPQwRe6Vpkn96NF
         MOYfvGNx3CUEdOIeIdKGwR0LnJVnxlyA1FQ9KM9EUWjNOD+lzvBbqjqnKrNYMeAMUyA7
         /K/w==
X-Received: by 10.50.87.71 with SMTP id v7mr296992igz.11.1380412685574;
        Sat, 28 Sep 2013 16:58:05 -0700 (PDT)
X-BeenThere: ruby-ffi@googlegroups.com
Received: by 10.50.88.98 with SMTP id bf2ls1065697igb.15.gmail; Sat, 28 Sep
 2013 16:58:05 -0700 (PDT)
X-Received: by 10.50.87.71 with SMTP id v7mr296991igz.11.1380412685164;
        Sat, 28 Sep 2013 16:58:05 -0700 (PDT)
Date: Sat, 28 Sep 2013 16:58:03 -0700 (PDT)
From: bawng@intoxicated.co.za
To: ruby-ffi@googlegroups.com
Message-Id: <c1a0f3f0-8e36-4b35-9191-ba74d9a14b1c@googlegroups.com>
In-Reply-To: <CAANDx0PX_20SiQ9qFmvNAVYbGoEg7gVjxo1kSHmtaYm4wu2ODg@mail.gmail.com>
References: <611ab497-78f1-4e8b-aeaa-0b552c354052@googlegroups.com>
 <CAANDx0PX_20SiQ9qFmvNAVYbGoEg7gVjxo1kSHmtaYm4wu2ODg@mail.gmail.com>
Subject: Re: [ruby-ffi] Function 'LoadIconMetric' not found in [kernel32,
 user32, gdi32, comctl32] (FFI::NotFoundError)
MIME-Version: 1.0
X-Original-Sender: bawng@intoxicated.co.za
Reply-To: ruby-ffi@googlegroups.com
Precedence: list
Mailing-list: list ruby-ffi@googlegroups.com; contact ruby-ffi+owners@googlegroups.com
List-ID: <ruby-ffi.googlegroups.com>
X-Google-Group-Id: 238405446264
List-Post: <http://groups.google.com/group/ruby-ffi/post>, <mailto:ruby-ffi@googlegroups.com>
List-Help: <http://groups.google.com/support/>, <mailto:ruby-ffi+help@googlegroups.com>
List-Archive: <http://groups.google.com/group/ruby-ffi>
Sender: ruby-ffi@googlegroups.com
List-Subscribe: <http://groups.google.com/group/ruby-ffi/subscribe>, <mailto:ruby-ffi+subscribe@googlegroups.com>
List-Unsubscribe: <http://groups.google.com/group/ruby-ffi/subscribe>, <mailto:googlegroups-manage+238405446264+unsubscribe@googlegroups.com>
Content-Type: multipart/alternative; 
	boundary="----=_Part_1074_1193415.1380412683664"

------=_Part_1074_1193415.1380412683664
Content-Type: text/plain; charset=ISO-8859-1

To be honest, I thought all details needed were already included, I should 
have included the error I put in the topic in my post body as well, maybe 
you didn't notice it in the topic.

The error says: Function 'LoadIconMetric' not found in [kernel32, user32, 
gdi32, comctl32] (FFI::NotFoundError)

 From that I thought it would be clear I am using ffi_lib to load those 4 
DLLs, comctl32.dll is supposed to contain LoadIconMetric but in order to 
use that function it needs to be loaded with the correct manifest 
specifying version 6 like my quoted C++ sample code explained.

> // we need commctrl v6 for LoadIconMetric()
> #pragma comment(linker,"/manifestdependency:\"type='win32' 
> name='Microsoft.Windows.Common-Controls' version='6.0.0.0' 
> processorArchitecture='*' publicKeyToken='6595b64144ccf1df' language='*'\"")
> #pragma comment(lib, "comctl32.lib")


 From what I can tell after searching the ffi source code and documentation, 
it does not appear to have any support for Windows manifests. I have even 
tried creating manual ffi_c.so.manifest file, but it does not get used. 
This is the first time I have had to learn about manifests and how DLLs can 
hide functions depending on the manifest version it was loaded with, I 
usually avoid Windows specific programming in general.

The best workaround I can think of is compiling my own custom proxy DLL 
written in C++ which defines that manifest with the #pragma line quoted 
above, load that DLL with FFI and use it to access the correct Windows API 
function.

It would be great if FFI could support manifests in future, so that you do 
not have to compile a proxy DLL file like this.

Thanks,
bawNg


On Sunday, September 29, 2013 12:31:03 AM UTC+2, Jon wrote:
>
> You've fallen prey to a great way to not get a response; making one work 
> harder in order to help.
>
> Always provide a minimal failing code snippet. Laziness can be great, but 
> you're being too lazy ;)
>
> That said, assuming something like pestudio or dependency walker failed to 
> find these symbols, could LoadIconMetric be a macro wrapping another API? I 
> don't have vc++ or the platform sdk on this machine to check, but 
> spelunking the headers might get you unstuck since
>
>
> http://msdn.microsoft.com/en-us/library/windows/desktop/bb775701%28v=vs.85%29.aspx
>
> is minimally helpful.
>
>
> On Sat, Sep 28, 2013 at 2:46 PM, <ba...@intoxicated.co.za <javascript:>>wrote:
>
>> Hello ruby-ffi,
>>
>> I am attempting to attach to the LoadIconMetric Windows API function 
>> which is part of comctl32. The function is not found and so can never be 
>> attached.
>>
>> The following 3 lines are taken from the top of one of the Microsoft VC++ 
>> sample projects cpp files:
>>
>>> // we need commctrl v6 for LoadIconMetric()
>>> #pragma comment(linker,"/manifestdependency:\"type='win32' 
>>> name='Microsoft.Windows.Common-Controls' version='6.0.0.0' 
>>> processorArchitecture='*' publicKeyToken='6595b64144ccf1df' language='*'\"")
>>> #pragma comment(lib, "comctl32.lib")
>>
>>
>>  This function is required in order to make use of the Windows system 
>> tray icon API. I really hope there is a simple solution to this problem.
>>
>> Thanks,
>> bawNg
>>
>> -- 
>>  
>> --- 
>> You received this message because you are subscribed to the Google Groups 
>> "ruby-ffi" group.
>> To unsubscribe from this group and stop receiving emails from it, send an 
>> email to ruby-ffi+u...@googlegroups.com <javascript:>.
>> For more options, visit https://groups.google.com/groups/opt_out.
>>
>
>

-- 

--- 
You received this message because you are subscribed to the Google Groups "ruby-ffi" group.
To unsubscribe from this group and stop receiving emails from it, send an email to ruby-ffi+unsubscribe@googlegroups.com.
For more options, visit https://groups.google.com/groups/opt_out.

------=_Part_1074_1193415.1380412683664
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">To be honest, I thought all details needed were already in=
cluded, I should have included the error I put in the topic in my post body=
 as well, maybe you didn't notice it in the topic.<div><br></div><div>The e=
rror says:&nbsp;Function 'LoadIconMetric' not found in [kernel32, user32, g=
di32, comctl32] (FFI::NotFoundError)</div><div><br></div><div>From that I t=
hought it would be clear I am using ffi_lib to load those 4 DLLs,&nbsp;comc=
tl32.dll is supposed to contain&nbsp;LoadIconMetric but in order to use tha=
t function it needs to be loaded with the correct manifest specifying versi=
on 6 like my quoted C++ sample code explained.</div><div><blockquote class=
=3D"gmail_quote" style=3D"margin: 0px 0px 0px 0.8ex; border-left-width: 1px=
; border-left-color: rgb(204, 204, 204); border-left-style: solid; padding-=
left: 1ex;">// we need commctrl v6 for LoadIconMetric()<br>#pragma comment(=
linker,"/<wbr>manifestdependency:\"type=3D'<wbr>win32' name=3D'Microsoft.Wi=
ndows.<wbr>Common-Controls' version=3D'6.0.0.0' processorArchitecture=3D'*'=
 publicKeyToken=3D'<wbr>6595b64144ccf1df' language=3D'*'\"")<br>#pragma com=
ment(lib, "comctl32.lib")</blockquote><div><br></div><div>From what I can t=
ell after searching the ffi source code and documentation, it does not appe=
ar to have any support for Windows manifests. I have even tried creating ma=
nual ffi_c.so.manifest file, but it does not get used. This is the first ti=
me I have had to learn about manifests and how DLLs can hide functions depe=
nding on the manifest version it was loaded with, I usually avoid Windows s=
pecific programming in general.</div><div><br></div><div>The best workaroun=
d I can think of is compiling my own custom proxy DLL written in C++ which =
defines that manifest with the #pragma line quoted above, load that DLL wit=
h FFI and use it to access the correct Windows API function.</div><div><br>=
</div><div>It would be great if FFI could support manifests in future, so t=
hat you do not have to compile a proxy DLL file like this.</div><div><br></=
div><div>Thanks,</div><div>bawNg</div><div><br></div><br>On Sunday, Septemb=
er 29, 2013 12:31:03 AM UTC+2, Jon wrote:<blockquote class=3D"gmail_quote" =
style=3D"margin: 0;margin-left: 0.8ex;border-left: 1px #ccc solid;padding-l=
eft: 1ex;"><div dir=3D"ltr"><div><div>You've fallen prey to a great way to =
not get a response; making one work harder in order to help.<br><br>Always =
provide a minimal failing code snippet. Laziness can be great, but you're b=
eing too lazy ;)<br>
</div><div><br></div>That said, assuming something like pestudio or depende=
ncy walker failed to find these symbols, could LoadIconMetric be a macro wr=
apping another API? I don't have vc++ or the platform sdk on this machine t=
o check, but spelunking the headers might get you unstuck since<br>
<br><a href=3D"http://msdn.microsoft.com/en-us/library/windows/desktop/bb77=
5701%28v=3Dvs.85%29.aspx" target=3D"_blank">http://msdn.microsoft.com/en-<w=
br>us/library/windows/desktop/<wbr>bb775701%28v=3Dvs.85%29.aspx</a><br><br>=
</div>is minimally helpful.<br>
</div><div><br><br><div class=3D"gmail_quote">On Sat, Sep 28, 2013 at 2:46 =
PM,  <span dir=3D"ltr">&lt;<a href=3D"javascript:" target=3D"_blank" gdf-ob=
fuscated-mailto=3D"HJfZK82H_MwJ">ba...@intoxicated.co.za</a>&gt;</span> wro=
te:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex"><div dir=3D"ltr">Hello ruby-ffi,<div><br></d=
iv><div>I am attempting to attach to the&nbsp;LoadIconMetric Windows API fu=
nction which is part of&nbsp;comctl32. The function is not found and so can=
 never be attached.</div>
<div><br></div><div>The following 3 lines are taken from the top of one of =
the Microsoft VC++ sample projects cpp files:</div><div><blockquote class=
=3D"gmail_quote" style=3D"margin:0px 0px 0px 0.8ex;border-left-width:1px;bo=
rder-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex">
// we need commctrl v6 for LoadIconMetric()<br>#pragma comment(linker,"/<wb=
r>manifestdependency:\"type=3D'<wbr>win32' name=3D'Microsoft.Windows.<wbr>C=
ommon-Controls' version=3D'6.0.0.0' processorArchitecture=3D'*' publicKeyTo=
ken=3D'<wbr>6595b64144ccf1df' language=3D'*'\"")<br>
#pragma comment(lib, "comctl32.lib")</blockquote><div><br></div><div>&nbsp;=
This function is required in order to make use of the Windows system tray i=
con API. I really hope there is a simple solution to this problem.</div>
</div><div><br></div><div>Thanks,</div><div>bawNg</div></div><span><font co=
lor=3D"#888888">

<p></p>

-- <br>
&nbsp;<br>
--- <br>
You received this message because you are subscribed to the Google Groups "=
ruby-ffi" group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"javascript:" target=3D"_blank" gdf-obfuscated-mailto=3D"=
HJfZK82H_MwJ">ruby-ffi+u...@<wbr>googlegroups.com</a>.<br>
For more options, visit <a href=3D"https://groups.google.com/groups/opt_out=
" target=3D"_blank">https://groups.google.com/<wbr>groups/opt_out</a>.<br>
</font></span></blockquote></div><br></div>
</blockquote></div></div>

<p></p>

-- <br />
&nbsp;<br />
--- <br />
You received this message because you are subscribed to the Google Groups &=
quot;ruby-ffi&quot; group.<br />
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to ruby-ffi+unsubscribe@googlegroups.com.<br />
For more options, visit <a href=3D"https://groups.google.com/groups/opt_out=
">https://groups.google.com/groups/opt_out</a>.<br />

------=_Part_1074_1193415.1380412683664--
