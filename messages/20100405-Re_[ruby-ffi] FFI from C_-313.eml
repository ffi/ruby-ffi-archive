Delivered-To: headius@headius.com
Received: by 10.151.8.3 with SMTP id l3cs214322ybi;
        Mon, 5 Apr 2010 01:42:54 -0700 (PDT)
Received: by 10.101.28.5 with SMTP id f5mr10150864anj.35.1270456974675;
        Mon, 05 Apr 2010 01:42:54 -0700 (PDT)
Return-Path: <3i6K5SwcJCDMbldiidcVbPXa.RdbgjQn-UUXVddVaTVgdjeh.Rdb@groups.bounces.google.com>
Received: from mail-gy0-f190.google.com (mail-gy0-f190.google.com [209.85.160.190])
        by mx.google.com with ESMTP id 5si3329729yxe.71.2010.04.05.01.42.53;
        Mon, 05 Apr 2010 01:42:53 -0700 (PDT)
Received-SPF: pass (google.com: domain of 3i6K5SwcJCDMbldiidcVbPXa.RdbgjQn-UUXVddVaTVgdjeh.Rdb@groups.bounces.google.com designates 209.85.160.190 as permitted sender) client-ip=209.85.160.190;
Authentication-Results: mx.google.com; spf=pass (google.com: domain of 3i6K5SwcJCDMbldiidcVbPXa.RdbgjQn-UUXVddVaTVgdjeh.Rdb@groups.bounces.google.com designates 209.85.160.190 as permitted sender) smtp.mail=3i6K5SwcJCDMbldiidcVbPXa.RdbgjQn-UUXVddVaTVgdjeh.Rdb@groups.bounces.google.com; dkim=pass (test mode) header.i=@googlegroups.com
Received: by gyg8 with SMTP id 8sf3060569gyg.7
        for <headius@headius.com>; Mon, 05 Apr 2010 01:42:53 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlegroups.com; s=beta;
        h=domainkey-signature:received:x-beenthere:received:received:received
         :received:received-spf:received:mime-version:received:in-reply-to
         :references:date:received:message-id:subject:from:to
         :x-original-authentication-results:x-original-sender:reply-to
         :precedence:mailing-list:list-id:list-post:list-help:list-archive
         :x-thread-url:x-message-url:sender:list-subscribe:list-unsubscribe
         :content-type:content-transfer-encoding;
        bh=LFbY3pzECJLVN/ebpLpqR+fIme1G0zIuQb+bqqm6IKc=;
        b=H0nOSHsMocTofPkcAUsD2QjuaeVb2n6bIkLBrV+iJ7xaezFp0rPg9vDiupCYgtC0Th
         cx0LDMsDLY7PBl6z/7MgGWuLEGuhPkLNOqJRb1NPWKO5S56sOMy12qcfkCb18l0JF+EZ
         8jc6J9xhiyGaeNqAQI1mNAnwYVKrSS2QsyyTs=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlegroups.com; s=beta;
        h=x-beenthere:received-spf:mime-version:in-reply-to:references:date
         :message-id:subject:from:to:x-original-authentication-results
         :x-original-sender:reply-to:precedence:mailing-list:list-id
         :list-post:list-help:list-archive:x-thread-url:x-message-url:sender
         :list-subscribe:list-unsubscribe:content-type
         :content-transfer-encoding;
        b=cRgXDRBCytGE5qKiHfH74ork0MdI/Jdc1+BCk1hWPlP0mg1Pe2v0v3w9Y2UgF8Nh6I
         IXfGrOt5kfL2qOY8H1vXMZkztHlkQe1FUAl8t3GfGVxOnpciwkgWS+6DIJr7i4Ex4k/s
         3yhcanYKE1OT+LK4GFaG92GP/a20L+JEt/nO4=
Received: by 10.91.127.5 with SMTP id e5mr195852agn.56.1270456971850;
        Mon, 05 Apr 2010 01:42:51 -0700 (PDT)
X-BeenThere: ruby-ffi@googlegroups.com
Received: by 10.231.51.234 with SMTP id e42ls11872ibg.2.p; Mon, 05 Apr 2010 
	01:42:51 -0700 (PDT)
Received: by 10.231.192.82 with SMTP id dp18mr337752ibb.26.1270456971085;
        Mon, 05 Apr 2010 01:42:51 -0700 (PDT)
Received: by 10.231.192.82 with SMTP id dp18mr337751ibb.26.1270456971064;
        Mon, 05 Apr 2010 01:42:51 -0700 (PDT)
Return-Path: <mwotton@gmail.com>
Received: from mail-pw0-f48.google.com (mail-pw0-f48.google.com [209.85.160.48])
        by gmr-mx.google.com with ESMTP id 24si1745587iwn.5.2010.04.05.01.42.49;
        Mon, 05 Apr 2010 01:42:50 -0700 (PDT)
Received-SPF: pass (google.com: domain of mwotton@gmail.com designates 209.85.160.48 as permitted sender) client-ip=209.85.160.48;
Received: by pwi7 with SMTP id 7so2650398pwi.7
        for <ruby-ffi@googlegroups.com>; Mon, 05 Apr 2010 01:42:49 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.114.106.15 with HTTP; Mon, 5 Apr 2010 01:42:49 -0700 (PDT)
In-Reply-To: <s2z4ccee321004050110mad26e3bg81a18a3a1f66b418@mail.gmail.com>
References: <f1480d60-84ff-47d3-961c-dd681dfb7ea9@g10g2000yqh.googlegroups.com>
	 <s2z4ccee321004050110mad26e3bg81a18a3a1f66b418@mail.gmail.com>
Date: Mon, 5 Apr 2010 18:42:49 +1000
Received: by 10.115.64.32 with SMTP id r32mr4310654wak.15.1270456969590; Mon, 
	05 Apr 2010 01:42:49 -0700 (PDT)
Message-ID: <w2t9ea53ad51004050142g57cbce69j5e4849b26725cf31@mail.gmail.com>
Subject: Re: [ruby-ffi] FFI from C?
From: Mark Wotton <mwotton@gmail.com>
To: ruby-ffi@googlegroups.com
X-Original-Authentication-Results: gmr-mx.google.com; spf=pass (google.com: 
	domain of mwotton@gmail.com designates 209.85.160.48 as permitted sender) 
	smtp.mail=mwotton@gmail.com; dkim=pass (test mode) header.i=@gmail.com
X-Original-Sender: mwotton@gmail.com
Reply-To: ruby-ffi@googlegroups.com
Precedence: list
Mailing-list: list ruby-ffi@googlegroups.com; contact ruby-ffi+owners@googlegroups.com
List-ID: <ruby-ffi.googlegroups.com>
List-Post: <http://groups.google.com/group/ruby-ffi/post?hl=en_US>, 
	<mailto:ruby-ffi@googlegroups.com>
List-Help: <http://groups.google.com/support/?hl=en_US>, <mailto:ruby-ffi+help@googlegroups.com>
List-Archive: <http://groups.google.com/group/ruby-ffi?hl=en_US>
X-Thread-Url: http://groups.google.com/group/ruby-ffi/t/60105d58f411128f
X-Message-Url: http://groups.google.com/group/ruby-ffi/msg/84dbf68c7838d0a8
Sender: ruby-ffi@googlegroups.com
List-Subscribe: <http://groups.google.com/group/ruby-ffi/subscribe?hl=en_US>, 
	<mailto:ruby-ffi+subscribe@googlegroups.com>
List-Unsubscribe: <http://groups.google.com/group/ruby-ffi/subscribe?hl=en_US>, 
	<mailto:ruby-ffi+unsubscribe@googlegroups.com>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

On Mon, Apr 5, 2010 at 6:10 PM, Wayne Meissner <wmeissner@gmail.com> wrote:
> Short answer is 'no' - there is no C api for Ruby-FFI.
>
> However, can you drive the integration from the ruby side, ala the lua
> bindings (http://github.com/jmettraux/rufus-lua)?
>
> I had a quick search for calling Haskell from C, and it looks like it
> might be doable - if its callable from straight C, then you can call
> it via FFI.
>
> Basically how it would go is:
>
> 1) create ruby wrapper method
> 2) massage ruby data into basic C types (int, string, struct, raw
> chunk of memory, etc)
> 3) call C method exported by Haskell with massaged parameters
> 4) convert Haskell result back into ruby type.
>
> Calling back into ruby from Haskell via a C function pointer works
> similarly, but in reverse.
>
> There was an example on stackoverflow using DL to do this - FFI would
> work much the same.
>
> If you're doing it the other way round, calling ruby from Haskell,
> you're doomed. =A0There is no common C api, and no C api at all on JRuby
> or IronRuby.

The use case is mostly to have Ruby calling Haskell - Haskell does
call back in to the MRI runtime currently, but only to query data
(accessing hashes/arrays etc). The tricky bit is that it then needs to
have libruby (or something similar) to build against, so you can then
dlopen the library in ruby. I could get around this by not including
ruby-specific code on the Haskell side, but part of the reason for
doing it on the Haskell side is that I can scan a Haskell module and
automatically export anything that would be callable from Ruby, which
is a rather nice feature. What I was hoping for was an
interpreter-agnostic C api to link against, but I guess that if that's
not available, I'll write my own C API for MRI 1.8 and 1.9 and add
JRuby support when I get a request for it.

Anyway, thank you for your considered response. The FFI is a really
good step forward for ruby interop, it's just a pity it's orthogonal
to my needs.

Cheers
Mark

--=20
A UNIX signature isn't a return address, it's the ASCII equivalent of a
black velvet clown painting. It's a rectangle of carets surrounding a
quote from a literary giant of weeniedom like Heinlein or Dr. Who.
        -- Chris Maeda


--=20
To unsubscribe, reply using "remove me" as the subject.
