Delivered-To: headius@headius.com
Received: by 10.223.89.144 with SMTP id e16cs460560fam;
        Wed, 5 Jan 2011 09:39:04 -0800 (PST)
Received: by 10.103.239.4 with SMTP id q4mr1708320mur.9.1294249143974;
        Wed, 05 Jan 2011 09:39:03 -0800 (PST)
Return-Path: <ruby-ffi+bncCO2O6dmYGhC22ZLpBBoEiMnRCQ@googlegroups.com>
Received: from mail-fx0-f62.google.com (mail-fx0-f62.google.com [209.85.161.62])
        by mx.google.com with ESMTP id 6si19628445fau.7.2011.01.05.09.39.02;
        Wed, 05 Jan 2011 09:39:02 -0800 (PST)
Received-SPF: pass (google.com: domain of ruby-ffi+bncCO2O6dmYGhC22ZLpBBoEiMnRCQ@googlegroups.com designates 209.85.161.62 as permitted sender) client-ip=209.85.161.62;
Authentication-Results: mx.google.com; spf=pass (google.com: domain of ruby-ffi+bncCO2O6dmYGhC22ZLpBBoEiMnRCQ@googlegroups.com designates 209.85.161.62 as permitted sender) smtp.mail=ruby-ffi+bncCO2O6dmYGhC22ZLpBBoEiMnRCQ@googlegroups.com; dkim=pass (test mode) header.i=@googlegroups.com
Received: by fxm6 with SMTP id 6sf5685597fxm.7
        for <headius@headius.com>; Wed, 05 Jan 2011 09:39:02 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlegroups.com; s=beta;
        h=domainkey-signature:received:x-beenthere:received:received:received
         :received:received-spf:received:received:mime-version:received
         :in-reply-to:references:from:date:message-id:subject:to
         :x-original-sender:x-original-authentication-results:reply-to
         :precedence:mailing-list:list-id:list-post:list-help:list-archive
         :sender:list-subscribe:list-unsubscribe:content-type
         :content-transfer-encoding;
        bh=fa6a9wbF/TVvZk/cfIEYWeJkv9aql6BlOpdDKgwA/GU=;
        b=X0IlpmXwgykN5JVz75nNmSRZv+HHdUm8zzYZGOcLz6yUCMdltThFZhLnyoReWv0HwT
         o424a219YpHx7jTq1qwdXqDl4eVor0qmuXhKDkhwcebw0L1ZmsBTARQ2RPJFgu3hQTzD
         gV2+e6QjSlQ8BzE7kUPba9SQhrYzZ64+8l0h4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlegroups.com; s=beta;
        h=x-beenthere:received-spf:mime-version:in-reply-to:references:from
         :date:message-id:subject:to:x-original-sender
         :x-original-authentication-results:reply-to:precedence:mailing-list
         :list-id:list-post:list-help:list-archive:sender:list-subscribe
         :list-unsubscribe:content-type:content-transfer-encoding;
        b=D9i2sNey8ts0IfE4BkvUZmwls0+ptTtKwWccQpLPRqKuU9qUeQ9XZnjNMzE3DRgij2
         jNOmRboWR4x7AEdxt/YEBTt3/B6OOLXklYbguBF67mspPu7fX5Kxi6p2uP4tPffWh2Rc
         Hdds3OQPcHTwmHejomJLCDbfPZtwQNj/F3Sjo=
Received: by 10.223.69.144 with SMTP id z16mr1492082fai.10.1294249142324;
        Wed, 05 Jan 2011 09:39:02 -0800 (PST)
X-BeenThere: ruby-ffi@googlegroups.com
Received: by 10.223.144.87 with SMTP id y23ls4537172fau.1.p; Wed, 05 Jan 2011
 09:39:01 -0800 (PST)
Received: by 10.223.120.19 with SMTP id b19mr1547641far.1.1294249141622;
        Wed, 05 Jan 2011 09:39:01 -0800 (PST)
Received: by 10.223.120.19 with SMTP id b19mr1547640far.1.1294249141581;
        Wed, 05 Jan 2011 09:39:01 -0800 (PST)
Received: from mail-fx0-f53.google.com (mail-fx0-f53.google.com [209.85.161.53])
        by gmr-mx.google.com with ESMTP id e12si1970657fav.12.2011.01.05.09.39.00;
        Wed, 05 Jan 2011 09:39:00 -0800 (PST)
Received-SPF: pass (google.com: domain of zevarito@gmail.com designates 209.85.161.53 as permitted sender) client-ip=209.85.161.53;
Received: by mail-fx0-f53.google.com with SMTP id 11so9033609fxm.12
        for <ruby-ffi@googlegroups.com>; Wed, 05 Jan 2011 09:39:00 -0800 (PST)
Received: by 10.223.102.79 with SMTP id f15mr1559924fao.134.1294249140383;
 Wed, 05 Jan 2011 09:39:00 -0800 (PST)
MIME-Version: 1.0
Received: by 10.223.2.132 with HTTP; Wed, 5 Jan 2011 09:38:40 -0800 (PST)
In-Reply-To: <CB82D07C-300A-4C5D-9E27-26B0E7E3DDD3@mac.com>
References: <AANLkTi=xpDSLc78295-Xczig6eZOvUTGhowgvc=+0u7w@mail.gmail.com>
 <27609662.2929.1294188954795.JavaMail.geo-discussion-forums@prnp16>
 <AANLkTi=J3FYct8sgenHCz-TEHbjdnBgopGcDYJmTbaeE@mail.gmail.com> <CB82D07C-300A-4C5D-9E27-26B0E7E3DDD3@mac.com>
From: Alvaro <zevarito@gmail.com>
Date: Wed, 5 Jan 2011 15:38:40 -0200
Message-ID: <AANLkTi=RRYra+biveDvor4D1JwVkF5Mmrx89G395N1O5@mail.gmail.com>
Subject: Re: [ruby-ffi] Re: freeing memory after FFI::MemoryPointer.new
To: ruby-ffi@googlegroups.com
X-Original-Sender: zevarito@gmail.com
X-Original-Authentication-Results: gmr-mx.google.com; spf=pass (google.com:
 domain of zevarito@gmail.com designates 209.85.161.53 as permitted sender)
 smtp.mail=zevarito@gmail.com; dkim=pass (test mode) header.i=@gmail.com
Reply-To: ruby-ffi@googlegroups.com
Precedence: list
Mailing-list: list ruby-ffi@googlegroups.com; contact ruby-ffi+owners@googlegroups.com
List-ID: <ruby-ffi.googlegroups.com>
List-Post: <http://groups.google.com/group/ruby-ffi/post?hl=en_US>, <mailto:ruby-ffi@googlegroups.com>
List-Help: <http://groups.google.com/support/?hl=en_US>, <mailto:ruby-ffi+help@googlegroups.com>
List-Archive: <http://groups.google.com/group/ruby-ffi?hl=en_US>
Sender: ruby-ffi@googlegroups.com
List-Subscribe: <http://groups.google.com/group/ruby-ffi/subscribe?hl=en_US>, <mailto:ruby-ffi+subscribe@googlegroups.com>
List-Unsubscribe: <http://groups.google.com/group/ruby-ffi/subscribe?hl=en_US>,
 <mailto:ruby-ffi+unsubscribe@googlegroups.com>
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

2011/1/5 Chuck Remes <cremes.devlist@mac.com>:
>
> On Jan 5, 2011, at 7:51 AM, Alvaro wrote:
>
>> I understand your point about how it works the garbage collection.
>> Is a kind strange that the C lib purely don't have leaks but with the
>> FFI binding it has and I couldn't find the reason yet, may be is
>> inherited to ruby, I've tested it with Ree, Mri and JRuby without
>> success.
>>
>> I will continue trying to figure out what is happening, thanks for
>> your comments.
>
> Is this code public and available online somewhere? If so, someone on thi=
s list may get curious and look at it too.
>
> It's possible, though unlikely, that the leak is in the FFI library. I ha=
d some massive leaks in a library I wrote using FFI, but I tracked 100% of =
them back to my own errors. There are now 0 leaks in the code (though I did=
 find a few minor ones in each Ruby runtime).
>
> cr
>
>

The code is not public available, but I am pasting it here:
http://pastie.org/private/lj5wqnlxdxwbe6ghjlpg

--=20
Alvaro
