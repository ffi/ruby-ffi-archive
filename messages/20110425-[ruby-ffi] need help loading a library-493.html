<html>
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>[ruby-ffi] need help loading a library</title>
<link rel="important stylesheet" href="">
<style>div.headerdisplayname {font-weight:bold;}</style></head>
<body>
<table border=0 cellspacing=0 cellpadding=0 width="100%" class="header-part1"><tr><td><div class="headerdisplayname" style="display:inline;">Subject: </div>[ruby-ffi] need help loading a library</td></tr><tr><td><div class="headerdisplayname" style="display:inline;">From: </div>Chuck Remes <cremes.devlist@mac.com></td></tr><tr><td><div class="headerdisplayname" style="display:inline;">Date: </div>4/25/11 2:50 PM</td></tr></table><table border=0 cellspacing=0 cellpadding=0 width="100%" class="header-part2"><tr><td><div class="headerdisplayname" style="display:inline;">To: </div>ruby-ffi <ruby-ffi@googlegroups.com></td></tr></table><br>
<div class="moz-text-plain" wrap=true graphical-quote=true style="font-family: -moz-fixed; font-size: 12px;" lang="x-western"><pre wrap>
I'm trying to get my ffi-rzmq gem running on Windows (Windows 7 x64). Using DevKit from the RubyInstaller project I was able to successfully build a 32-bit version of the zeromq library. I created a /c/usr/local path and installed the library to that location. Additionally, I installed the ffi gem with 'ruby -S gem install ffi --platform=ruby' where ruby is 1.9.1-p430 so that it would be built using DevKit.

When I tried to require the ffi-rzmq gem, it failed on the call to #ffi_lib. The errors are listed in the pastie.

<a class="moz-txt-link-freetext" href="https://gist.github.com/941051">https://gist.github.com/941051</a>

At /usr/local/lib there is a file named libzmq.dll.a and libzmq.la. I tried copying the <b class="moz-txt-star"><span class="moz-txt-tag">*</span>dll<span class="moz-txt-tag">*</span></b> file to the local working directory and trying again. It didn't work and complained about not being able to find the file.

On a lark I renamed libzmq.dll.a to libzmq.dll and tried again. This time it found the library file but Windows throws up a dialog box with the following text:

</pre><blockquote type=cite style="color: #000000;"><pre wrap>
<span class="moz-txt-citetags">&gt; </span>z:\mygit\ffi-rzmq\examples\libzmq.DLL is either not designed to run on Windows or it contains an error. Try installing the program again using the original installation media or contact your system administrator or the software vendor for support.
</pre></blockquote><pre wrap>



I also tried it with JRuby 1.5.5. It's output is here at <a class="moz-txt-link-freetext" href="https://gist.github.com/941074">https://gist.github.com/941074</a>

I tried it with libzmq.dll.a and renamed to libzmq.dll. It didn't work either way but it also did not throw up the warning box like MRI did.

What am I doing wrong here? Any suggestions for further troubleshooting this issue?

cr
</pre></div></body>
</html>
</table></div>