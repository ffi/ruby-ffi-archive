Delivered-To: headius@headius.com
Received: by 10.142.52.18 with SMTP id z18cs181979wfz;
        Fri, 27 Nov 2009 09:41:51 -0800 (PST)
Received: by 10.220.122.94 with SMTP id k30mr1501508vcr.72.1259343710816;
        Fri, 27 Nov 2009 09:41:50 -0800 (PST)
Return-Path: <3Ww8QSwoJCMUuzy.qz25x3rxltw.nzx25m9-qqtrzzrwpr2z503.nzx@listserv.bounces.google.com>
Received: from mail-vw0-f143.google.com (mail-vw0-f143.google.com [209.85.212.143])
        by mx.google.com with ESMTP id 36si2548545vws.130.2009.11.27.09.41.49;
        Fri, 27 Nov 2009 09:41:49 -0800 (PST)
Received-SPF: pass (google.com: domain of 3Ww8QSwoJCMUuzy.qz25x3rxltw.nzx25m9-qqtrzzrwpr2z503.nzx@listserv.bounces.google.com designates 209.85.212.143 as permitted sender) client-ip=209.85.212.143;
Authentication-Results: mx.google.com; spf=pass (google.com: domain of 3Ww8QSwoJCMUuzy.qz25x3rxltw.nzx25m9-qqtrzzrwpr2z503.nzx@listserv.bounces.google.com designates 209.85.212.143 as permitted sender) smtp.mail=3Ww8QSwoJCMUuzy.qz25x3rxltw.nzx25m9-qqtrzzrwpr2z503.nzx@listserv.bounces.google.com; dkim=pass (test mode) header.i=@gmail.com
Received: by vws7 with SMTP id 7sf770285vws.22
        for <headius@headius.com>; Fri, 27 Nov 2009 09:41:49 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:x-beenthere:received:received:received
         :received:received-spf:received:received:received:date:from:to
         :subject:message-id:x-mailer:mime-version
         :x-original-authentication-results:reply-to:precedence:mailing-list
         :list-id:list-post:list-help:list-archive:x-thread-url:x-message-url
         :list-unsubscribe:list-subscribe:content-type
         :content-transfer-encoding;
        bh=k2hB1h5l/3dbFRBMLZcqSWfm9NJthDVxg6bTV4DxMVs=;
        b=bKbx4PGn39CiP6ii920dpwj8uUjzuFkUEZ9DFgnH9Y1k4mYktKNNB8N7trnklFerIf
         YfxsBLBwSKeZdOI8LC/CWAMjy5F02hIpYNzdGAcJIZXVVGVMz55eekxvw1K+TQZZ+ogv
         rKv3zkiHuEp5MIB92FQ+rAbsujCVH9nz8Z7lg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=x-beenthere:received-spf:date:from:to:subject:message-id:x-mailer
         :mime-version:x-original-authentication-results:reply-to:precedence
         :mailing-list:list-id:list-post:list-help:list-archive:x-thread-url
         :x-message-url:list-unsubscribe:list-subscribe:content-type
         :content-transfer-encoding;
        b=OjDa932rXWktOARI7IWJHJag636Ei1302Lgvpnyu1BbYlU7xg8ZkwZ+4AA/zWsWEbg
         IgekevUi1Pqg/pu7mnsuiVRLUqDJd19fqdqk3DX2qfVFC88jfGeB5QuRNd/xRig6RYPk
         ValWRAfF8ue9tW3GgJCR4CPmK0yVUbOV73gZM=
Received: by 10.220.88.213 with SMTP id b21mr27696vcm.1.1259343707877;
        Fri, 27 Nov 2009 09:41:47 -0800 (PST)
X-BeenThere: ruby-ffi@googlegroups.com
Received: by 10.220.78.37 with SMTP id i37ls836027vck.3.p; Fri, 27 Nov 2009 
	09:41:47 -0800 (PST)
Received: by 10.220.87.146 with SMTP id w18mr271797vcl.7.1259343706920;
        Fri, 27 Nov 2009 09:41:46 -0800 (PST)
Received: by 10.220.87.146 with SMTP id w18mr271796vcl.7.1259343706902;
        Fri, 27 Nov 2009 09:41:46 -0800 (PST)
Return-Path: <jon.forums@gmail.com>
Received: from mail-qy0-f176.google.com (mail-qy0-f176.google.com [209.85.221.176])
        by gmr-mx.google.com with ESMTP id 24si156711vws.12.2009.11.27.09.41.45;
        Fri, 27 Nov 2009 09:41:45 -0800 (PST)
Received-SPF: pass (google.com: domain of jon.forums@gmail.com designates 209.85.221.176 as permitted sender) client-ip=209.85.221.176;
Received: by qyk6 with SMTP id 6so709697qyk.3
        for <ruby-ffi@googlegroups.com>; Fri, 27 Nov 2009 09:41:45 -0800 (PST)
Received: by 10.224.52.220 with SMTP id j28mr629118qag.289.1259343705630;
        Fri, 27 Nov 2009 09:41:45 -0800 (PST)
Return-Path: <jon.forums@gmail.com>
Received: from Red (cpe-71-65-104-132.woh.res.rr.com [71.65.104.132])
        by mx.google.com with ESMTPS id 7sm4914888qwb.2.2009.11.27.09.41.44
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Fri, 27 Nov 2009 09:41:45 -0800 (PST)
Date: Fri, 27 Nov 2009 12:41:31 -0500
From: Jon <jon.forums@gmail.com>
To: ruby-ffi@googlegroups.com
Subject: [ruby-ffi] segfault on windows MRI but not windows JRuby
Message-Id: <20091127124131.0f3ca7b2.jon.forums@gmail.com>
X-Mailer: Sylpheed 2.7.1 (GTK+ 2.10.14; i686-pc-mingw32)
Mime-Version: 1.0
X-Original-Authentication-Results: gmr-mx.google.com; spf=pass (google.com: 
	domain of jon.forums@gmail.com designates 209.85.221.176 as permitted sender) 
	smtp.mail=jon.forums@gmail.com; dkim=pass (test mode) header.i=@gmail.com
Reply-To: ruby-ffi@googlegroups.com
Precedence: list
Mailing-list: list ruby-ffi@googlegroups.com; contact ruby-ffi+owners@googlegroups.com
List-ID: <ruby-ffi.googlegroups.com>
List-Post: <http://groups.google.com/group/ruby-ffi/post?hl=>, 
	<mailto:ruby-ffi@googlegroups.com>
List-Help: <http://groups.google.com/support/?hl=>, <mailto:ruby-ffi+help@googlegroups.com>
List-Archive: <http://groups.google.com/group/ruby-ffi?hl=>
X-Thread-Url: http://groups.google.com/group/ruby-ffi/t/1712f5507b15b467
X-Message-Url: http://groups.google.com/group/ruby-ffi/msg/93b13a9f4dc59c41
List-Unsubscribe: <http://groups.google.com/group/ruby-ffi/subscribe?hl=>, 
	<mailto:ruby-ffi+unsubscribe@googlegroups.com>
List-Subscribe: <http://groups.google.com/group/ruby-ffi/subscribe?hl=>, 
	<mailto:ruby-ffi+subscribe@googlegroups.com>
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit

In the Novice section of http://wiki.github.com/ffi/ffi/windows-examples I'm trying to finish the Enumerate Top Level Windows example and am getting segfaults under MRI 1.8.6 and 1.9.1 but not JRuby 1.4.0 in either 1.8 or 1.9 modes.

I'm ramping up to speed on FFI and not yet sure whether it's my code or the MRI FFI impl or a Ruby impl issue or something else.

Details below, but in the segfault cases the top-level windows are enumerated and then the segfault occurs.  I've futzed with the signatures (e.g. changed EnumDesktopWindows return type from :bool to :int as windows "typedef int BOOL"), kept the Ruby script alive with "STDIN.gets" at script end, and futzed with param types to EnumDesktopWindows all to no avail.

What have I missed?

Jon



DETAILS
=======
> ruby --version
ruby 1.9.1p243 (2009-07-16 revision 24175) [i386-mingw32]

> gem --version
1.3.5

> gem list ffi

*** LOCAL GEMS ***

ffi (0.5.3)


> ruby ffi_enumwin.rb
[001] Found ''
<..SNIP..>
[303] Found ''
[304] Found ''
[305] Found ''
[306] Found ''
[307] Found ''
[308] Found ''
[309] Found ''
[310] Found ''
[311] Found ''
[312] Found ''
[313] Found ''
[314] Found ''
[315] Found ''
(eval):3: [BUG] Segmentation fault
ruby 1.9.1p243 (2009-07-16 revision 24175) [i386-mingw32]

-- control frame ----------
c:0005 p:---- s:0018 b:0018 l:000017 d:000017 CFUNC  :call
c:0004 p:0016 s:0012 b:0012 l:000011 d:000011 METHOD (eval):3
c:0003 p:0073 s:0007 b:0007 l:001bb4 d:001888 EVAL   ffi_enumwin.rb:20
c:0002 p:---- s:0004 b:0004 l:000003 d:000003 FINISH
c:0001 p:0000 s:0002 b:0002 l:001bb4 d:001bb4 TOP
---------------------------
-- Ruby level backtrace information-----------------------------------------
(eval):3:in `call'
(eval):3:in `EnumDesktopWindows'
ffi_enumwin.rb:20:in `<main>'
