Delivered-To: headius@headius.com
Received: by 10.182.35.162 with SMTP id i2csp178860obj;
        Fri, 4 May 2012 19:43:58 -0700 (PDT)
Received: by 10.236.191.233 with SMTP id g69mr10812907yhn.20.1336185838334;
        Fri, 04 May 2012 19:43:58 -0700 (PDT)
Return-Path: <ruby-ffi+bncCO-tnrmIAhDup5L9BBoE8uP9cg@googlegroups.com>
Received: from mail-gy0-f190.google.com (mail-gh0-f190.google.com [209.85.160.190])
        by mx.google.com with ESMTPS id j13si3710265ank.179.2012.05.04.19.43.58
        (version=TLSv1/SSLv3 cipher=OTHER);
        Fri, 04 May 2012 19:43:58 -0700 (PDT)
Received-SPF: pass (google.com: domain of ruby-ffi+bncCO-tnrmIAhDup5L9BBoE8uP9cg@googlegroups.com designates 209.85.160.190 as permitted sender) client-ip=209.85.160.190;
Authentication-Results: mx.google.com; spf=pass (google.com: domain of ruby-ffi+bncCO-tnrmIAhDup5L9BBoE8uP9cg@googlegroups.com designates 209.85.160.190 as permitted sender) smtp.mail=ruby-ffi+bncCO-tnrmIAhDup5L9BBoE8uP9cg@googlegroups.com; dkim=pass header.i=@googlegroups.com
Received: by ghbg22 with SMTP id g22sf8474783ghb.7
        for <headius@headius.com>; Fri, 04 May 2012 19:43:58 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlegroups.com; s=beta;
        h=x-beenthere:received-spf:mime-version:in-reply-to:references:date
         :message-id:subject:from:to:x-original-sender
         :x-original-authentication-results:reply-to:precedence:mailing-list
         :list-id:x-google-group-id:list-post:list-help:list-archive:sender
         :list-subscribe:list-unsubscribe:content-type;
        bh=YMKYCmJcwIVz0kKc0hoLa1W14QkpQ3qL8/EaGuieypA=;
        b=PFZLW5ySIiku+AsPfH5A4LRaGYmiArdMXeDiV6MEhNwaKoid4U4whpuF5jdl8mW5ft
         AQ+8U5M+BGPuaw+PsHa57ad/pqHCFtO8jsDggODWqB7YtEd9NVJM40C5YcLtgKYdniGB
         aCy7ci2Q0o6uM6bEM6N2xDgxxNfxwMfEXbz5s=
Received: by 10.52.33.47 with SMTP id o15mr230327vdi.9.1336185838017;
        Fri, 04 May 2012 19:43:58 -0700 (PDT)
X-BeenThere: ruby-ffi@googlegroups.com
Received: by 10.220.155.11 with SMTP id q11ls1259302vcw.4.gmail; Fri, 04 May
 2012 19:43:57 -0700 (PDT)
Received: by 10.52.35.112 with SMTP id g16mr575192vdj.4.1336185837629;
        Fri, 04 May 2012 19:43:57 -0700 (PDT)
Received: by 10.52.35.112 with SMTP id g16mr575190vdj.4.1336185837610;
        Fri, 04 May 2012 19:43:57 -0700 (PDT)
Received: from mail-vx0-f172.google.com (mail-vc0-f172.google.com [209.85.220.172])
        by gmr-mx.google.com with ESMTPS id cz20si4964833vdb.0.2012.05.04.19.43.57
        (version=TLSv1/SSLv3 cipher=OTHER);
        Fri, 04 May 2012 19:43:57 -0700 (PDT)
Received-SPF: pass (google.com: domain of kiwi.swhite.coder@gmail.com designates 209.85.220.172 as permitted sender) client-ip=209.85.220.172;
Received: by vcbfo1 with SMTP id fo1so3836759vcb.17
        for <ruby-ffi@googlegroups.com>; Fri, 04 May 2012 19:43:57 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.220.180.195 with SMTP id bv3mr5262044vcb.34.1336185837476;
 Fri, 04 May 2012 19:43:57 -0700 (PDT)
Received: by 10.220.16.77 with HTTP; Fri, 4 May 2012 19:43:57 -0700 (PDT)
In-Reply-To: <32508109.877.1336039325835.JavaMail.geo-discussion-forums@pbfk7>
References: <125321c0-cb8b-42f9-96eb-fc5bb9194d28@l4g2000pbv.googlegroups.com>
	<32508109.877.1336039325835.JavaMail.geo-discussion-forums@pbfk7>
Date: Sat, 5 May 2012 10:43:57 +0800
Message-ID: <CALV7_M=ySHA3txQWU8wDTOT4Tfqw=0BKY1KziogTuatZQGeN+g@mail.gmail.com>
Subject: Re: [ruby-ffi] Re: My first example failed, can anyone help me?
From: win kiwi <kiwi.swhite.coder@gmail.com>
To: ruby-ffi@googlegroups.com
X-Original-Sender: kiwi.swhite.coder@gmail.com
X-Original-Authentication-Results: gmr-mx.google.com; spf=pass (google.com:
 domain of kiwi.swhite.coder@gmail.com designates 209.85.220.172 as permitted
 sender) smtp.mail=kiwi.swhite.coder@gmail.com; dkim=pass header.i=@gmail.com
Reply-To: ruby-ffi@googlegroups.com
Precedence: list
Mailing-list: list ruby-ffi@googlegroups.com; contact ruby-ffi+owners@googlegroups.com
List-ID: <ruby-ffi.googlegroups.com>
X-Google-Group-Id: 238405446264
List-Post: <http://groups.google.com/group/ruby-ffi/post?hl=en_US>, <mailto:ruby-ffi@googlegroups.com>
List-Help: <http://groups.google.com/support/?hl=en_US>, <mailto:ruby-ffi+help@googlegroups.com>
List-Archive: <http://groups.google.com/group/ruby-ffi?hl=en_US>
Sender: ruby-ffi@googlegroups.com
List-Subscribe: <http://groups.google.com/group/ruby-ffi/subscribe?hl=en_US>, <mailto:ruby-ffi+subscribe@googlegroups.com>
List-Unsubscribe: <http://groups.google.com/group/ruby-ffi/subscribe?hl=en_US>,
 <mailto:googlegroups-manage+238405446264+unsubscribe@googlegroups.com>
Content-Type: multipart/alternative; boundary=90e6ba53a91a325b3204bf4102dc

--90e6ba53a91a325b3204bf4102dc
Content-Type: text/plain; charset=ISO-8859-1

Thank you very much. It works now. But this is little weird.
Before add extern "C", I also write a C code to test the shared library. It
works well.

2012/5/3 Wayne Meissner <wmeissner@gmail.com>

> You need to declare the native function as 'extern "C"'
>
> e.g.
>
> extern "C" void hello();
>
>
>
> On Thursday, May 3, 2012 6:43:45 PM UTC+10, win kiwi wrote:
>>
>> I write a c header file:
>>
>> hello.h
>> ------------------------------**-
>> extern void hello();
>> ------------------------------**-
>>
>> souce file: hello.cpp
>> ------------------------------
>> #include "hello.h"
>> #include <stdio.h>
>>
>> void hello() {
>>         printf("hello");
>> }
>> ------------------------------
>>
>> I use this command to generate .so in ubuntu:
>>
>> g++ -O -fpic -shared -o hello.so hello.cpp
>>
>>
>> Now, the hello.so is under my directory.
>>
>> I write a ruby file: helloLib.rb:
>> -----------------------------
>> require 'ffi'
>> module HelloLib
>>         extend FFI::Library
>>         ffi_lib File.dirname(__FILE__) + "/hello.so"
>>         attach_function :hello, [], :void
>> end
>> ----------------------------
>>
>> then, I write codes to call this wrapper
>>
>> hellotest.rb
>> ------------------------------**-
>> require 'rubygems'
>> require 'ffi'
>> require 'helloLib'
>>
>> HelloLib.hello()
>> ------------------------------**-
>>
>> I type : ruby ./hellotest.rb at the console . get following error
>> information:
>>
>>
>> /var/lib/gems/1.8/gems/ffi-1.**0.11/lib/ffi/library.rb:249:in
>> `attach_function': Function 'hello' not found in [./hello.so]
>> (FFI::NotFoundError)
>>         from ./helloLib.rb:5
>>         from /usr/lib/ruby/1.8/rubygems/**custom_require.rb:31:in
>> `gem_original_require'
>>         from /usr/lib/ruby/1.8/rubygems/**custom_require.rb:31:in
>> `require'
>>         from ./hellotest.rb:3
>>
>>
>> Can any one give me suggestion? Thank you.
>
>

--90e6ba53a91a325b3204bf4102dc
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Thank you very much. It works now. But this is little weird.=A0<div>Before =
add extern &quot;C&quot;, I also write a C code to test the shared library.=
 It works well.<br><br><div class=3D"gmail_quote">2012/5/3 Wayne Meissner <=
span dir=3D"ltr">&lt;<a href=3D"mailto:wmeissner@gmail.com" target=3D"_blan=
k">wmeissner@gmail.com</a>&gt;</span><br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">You need to declare the native function as &=
#39;extern &quot;C&quot;&#39;<div><br></div><div>e.g.</div><div><br></div><=
div>
extern &quot;C&quot; void hello();</div><div class=3D"HOEnZb"><div class=3D=
"h5"><div><br></div><div><br><br>On Thursday, May 3, 2012 6:43:45 PM UTC+10=
, win kiwi wrote:<blockquote class=3D"gmail_quote" style=3D"margin:0;margin=
-left:0.8ex;border-left:1px #ccc solid;padding-left:1ex">
I write a c header file:
<br>
<br>hello.h
<br>------------------------------<u></u>-
<br>extern void hello();
<br>------------------------------<u></u>-
<br>
<br>souce file: hello.cpp
<br>------------------------------
<br>#include &quot;hello.h&quot;
<br>#include &lt;stdio.h&gt;
<br>
<br>void hello() {
<br>=A0=A0=A0=A0=A0=A0=A0=A0printf(&quot;hello&quot;);
<br>}
<br>------------------------------
<br>
<br>I use this command to generate .so in ubuntu:
<br>
<br>g++ -O -fpic -shared -o hello.so hello.cpp
<br>
<br>
<br>Now, the hello.so is under my directory.
<br>
<br>I write a ruby file: helloLib.rb:
<br>-----------------------------
<br>require &#39;ffi&#39;
<br>module HelloLib
<br>=A0=A0=A0=A0=A0=A0=A0=A0extend FFI::Library
<br>=A0=A0=A0=A0=A0=A0=A0=A0ffi_lib File.dirname(__FILE__) + &quot;/hello.s=
o&quot;
<br>=A0=A0=A0=A0=A0=A0=A0=A0attach_function :hello, [], :void
<br>end
<br>----------------------------
<br>
<br>then, I write codes to call this wrapper
<br>
<br>hellotest.rb
<br>------------------------------<u></u>-
<br>require &#39;rubygems&#39;
<br>require &#39;ffi&#39;
<br>require &#39;helloLib&#39;
<br>
<br>HelloLib.hello()
<br>------------------------------<u></u>-
<br>
<br>I type : ruby ./hellotest.rb at the console . get following error
<br>information:
<br>
<br>
<br>/var/lib/gems/1.8/gems/ffi-1.<u></u>0.11/lib/ffi/library.rb:249:in
<br>`attach_function&#39;: Function &#39;hello&#39; not found in [./hello.s=
o]
<br>(FFI::NotFoundError)
<br>=A0=A0=A0=A0=A0=A0=A0=A0from ./helloLib.rb:5
<br>=A0=A0=A0=A0=A0=A0=A0=A0from /usr/lib/ruby/1.8/rubygems/<u></u>custom_r=
equire.rb:31:in
<br>`gem_original_require&#39;
<br>=A0=A0=A0=A0=A0=A0=A0=A0from /usr/lib/ruby/1.8/rubygems/<u></u>custom_r=
equire.rb:31:in `require&#39;
<br>=A0=A0=A0=A0=A0=A0=A0=A0from ./hellotest.rb:3
<br>
<br>
<br>Can any one give me suggestion? Thank you.</blockquote></div></div></di=
v></blockquote></div><br></div>

--90e6ba53a91a325b3204bf4102dc--
