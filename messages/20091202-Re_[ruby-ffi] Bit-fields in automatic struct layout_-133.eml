Delivered-To: headius@headius.com
Received: by 10.142.52.18 with SMTP id z18cs399546wfz;
        Wed, 2 Dec 2009 10:43:36 -0800 (PST)
Received: by 10.114.119.6 with SMTP id r6mr1015761wac.45.1259779415877;
        Wed, 02 Dec 2009 10:43:35 -0800 (PST)
Return-Path: <3VrUWSwQPCG0PgLYQLWWTYRdYZh.YPecfMj-QQTRZZRWPRcZfad.NZX@listserv.bounces.google.com>
Received: from mail-pw0-f68.google.com (mail-pw0-f68.google.com [209.85.160.68])
        by mx.google.com with ESMTP id 34si3293813pzk.13.2009.12.02.10.43.35;
        Wed, 02 Dec 2009 10:43:35 -0800 (PST)
Received-SPF: pass (google.com: domain of 3VrUWSwQPCG0PgLYQLWWTYRdYZh.YPecfMj-QQTRZZRWPRcZfad.NZX@listserv.bounces.google.com designates 209.85.160.68 as permitted sender) client-ip=209.85.160.68;
Authentication-Results: mx.google.com; spf=pass (google.com: domain of 3VrUWSwQPCG0PgLYQLWWTYRdYZh.YPecfMj-QQTRZZRWPRcZfad.NZX@listserv.bounces.google.com designates 209.85.160.68 as permitted sender) smtp.mail=3VrUWSwQPCG0PgLYQLWWTYRdYZh.YPecfMj-QQTRZZRWPRcZfad.NZX@listserv.bounces.google.com
Received: by pwj16 with SMTP id 16sf105646pwj.27
        for <headius@headius.com>; Wed, 02 Dec 2009 10:43:35 -0800 (PST)
Received: by 10.140.173.1 with SMTP id v1mr36468rve.12.1259779414318;
        Wed, 02 Dec 2009 10:43:34 -0800 (PST)
X-BeenThere: ruby-ffi@googlegroups.com
Received: by 10.141.105.10 with SMTP id h10ls472297rvm.3.p; Wed, 02 Dec 2009 
	10:43:32 -0800 (PST)
Received: by 10.140.127.18 with SMTP id z18mr92182rvc.2.1259779412361;
        Wed, 02 Dec 2009 10:43:32 -0800 (PST)
Received: by 10.140.127.18 with SMTP id z18mr92181rvc.2.1259779412339;
        Wed, 02 Dec 2009 10:43:32 -0800 (PST)
Return-Path: <evan@fallingsnow.net>
Received: from elle.fallingsnow.net (elle.fallingsnow.net [67.43.164.196])
        by gmr-mx.google.com with ESMTP id 25si165617pzk.3.2009.12.02.10.43.32;
        Wed, 02 Dec 2009 10:43:32 -0800 (PST)
Received-SPF: pass (google.com: best guess record for domain of evan@fallingsnow.net designates 67.43.164.196 as permitted sender) client-ip=67.43.164.196;
Received: from cpe-76-170-133-160.socal.res.rr.com ([76.170.133.160] helo=[10.0.1.194])
	by elle.fallingsnow.net with esmtpa (Exim 4.69)
	(envelope-from <evan@fallingsnow.net>)
	id 1NFuAg-0001uk-7K
	for ruby-ffi@googlegroups.com; Wed, 02 Dec 2009 10:43:30 -0800
Mime-Version: 1.0 (Apple Message framework v1077)
From: Evan Phoenix <evan@fallingsnow.net>
In-Reply-To: <12ad2ba9-0454-485b-ac4e-0767b9b8588d@c3g2000yqd.googlegroups.com>
Date: Wed, 2 Dec 2009 10:43:25 -0800
Message-Id: <E32747FC-7077-4000-A6AB-37E434FD96F0@fallingsnow.net>
References: <12ad2ba9-0454-485b-ac4e-0767b9b8588d@c3g2000yqd.googlegroups.com>
To: ruby-ffi@googlegroups.com
X-Mailer: Apple Mail (2.1077)
X-SA-Exim-Connect-IP: 76.170.133.160
X-SA-Exim-Mail-From: evan@fallingsnow.net
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on elle.fallingsnow.net
X-Spam-Level: 
X-Spam-Status: No, score=-4.2 required=5.0 tests=ALL_TRUSTED,AWL,BAYES_00
	autolearn=ham version=3.2.5
Subject: Re: [ruby-ffi] Bit-fields in automatic struct layout?
X-SA-Exim-Version: 4.2.1 (built Wed, 25 Jun 2008 17:14:11 +0000)
X-SA-Exim-Scanned: Yes (on elle.fallingsnow.net)
X-Original-Authentication-Results: gmr-mx.google.com; spf=pass (google.com: 
	best guess record for domain of evan@fallingsnow.net designates 67.43.164.196 
	as permitted sender) smtp.mail=evan@fallingsnow.net
Reply-To: ruby-ffi@googlegroups.com
Precedence: list
Mailing-list: list ruby-ffi@googlegroups.com; contact ruby-ffi+owners@googlegroups.com
List-ID: <ruby-ffi.googlegroups.com>
List-Post: <http://groups.google.com/group/ruby-ffi/post?hl=>, 
	<mailto:ruby-ffi@googlegroups.com>
List-Help: <http://groups.google.com/support/?hl=>, <mailto:ruby-ffi+help@googlegroups.com>
List-Archive: <http://groups.google.com/group/ruby-ffi?hl=>
X-Thread-Url: http://groups.google.com/group/ruby-ffi/t/47fe9c561003bccd
X-Message-Url: http://groups.google.com/group/ruby-ffi/msg/9ad74f6c17c79d67
List-Unsubscribe: <http://groups.google.com/group/ruby-ffi/subscribe?hl=>, 
	<mailto:ruby-ffi+unsubscribe@googlegroups.com>
List-Subscribe: <http://groups.google.com/group/ruby-ffi/subscribe?hl=>, 
	<mailto:ruby-ffi+subscribe@googlegroups.com>
Content-Type: text/plain; charset=windows-1252
Content-Transfer-Encoding: quoted-printable


On Dec 2, 2009, at 10:07 AM, Simon Chiang wrote:

> I'm trying to convert the following struct into an FFI::Struct using
> the struct generator:
>=20
>    struct symbolHashNode
>      {
>       struct symbolHashNode *next;
>       long count;
>       int depth;
>       unsigned int permanent : 1;
>       unsigned int markedEphemeral : 1;
>       unsigned int neededSymbol : 1;
>       unsigned int bucket : 29;
>       char *contents;
>      };
>=20
> My question is, how do I specify the bit-fields?  When I do the naive
> thing:

Bitfields are not supported and there is no current desire to do so.

You should declare there to be a single :uint field for all 4 of those =
and do your own bit manipulation to extract the bits you need.

 - Evan

>=20
>    class SymbolHashNode < FFI::Struct
>      @@@
>      struct do |s|
>        s.name 'struct symbolHashNode'
>        s.include 'symbol.h'
>=20
>        s.field :next, :symbolHashNode
>        s.field :count, :long
>        s.field :depth, :int
>        s.field :permanent, :uint
>        s.field :markedEphemeral, :uint
>        s.field :neededSymbol, :uint
>        s.field :bucket, :uint
>        s.field :contents, :string
>      end
>      @@@
>    end
>=20
> I get errors like:
>=20
>  attempt to take address of bit-field structure member =91permanent=92
>  =91sizeof=92 applied to a bit-field
>=20
> Thanks!
>=20

